<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>31 Restructuring data frames | R for Epidemiology</title>
  <meta name="description" content="This is the textbook for Brad Cannell’s Introduction to R Programming for Epidemiologic Research course." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="31 Restructuring data frames | R for Epidemiology" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://brad-cannell.github.io/r4epi/" />
  <meta property="og:image" content="https://brad-cannell.github.io/r4epi/r4epi_icon.png" />
  <meta property="og:description" content="This is the textbook for Brad Cannell’s Introduction to R Programming for Epidemiologic Research course." />
  <meta name="github-repo" content="brad-cannell/r4epi" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="31 Restructuring data frames | R for Epidemiology" />
  
  <meta name="twitter:description" content="This is the textbook for Brad Cannell’s Introduction to R Programming for Epidemiologic Research course." />
  <meta name="twitter:image" content="https://brad-cannell.github.io/r4epi/r4epi_icon.png" />

<meta name="author" content="Brad Cannell" />


<meta name="date" content="2022-01-05" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="working-with-multiple-data-frames.html"/>
<link rel="next" href="introduction-to-repeated-operations.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.20/datatables.js"></script>
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0RREBTQ0D9"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-0RREBTQ0D9');
</script>
<!-- R4Epi Favicons -->
<!-- https://bookdown.org/yihui/rmarkdown-cookbook/favicon.html -->
<!-- Also using Favicon Generator (https://realfavicongenerator.net) -->
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R for Epidemiology</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#goals"><i class="fa fa-check"></i>Goals</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#text-conventions-used-in-this-book"><i class="fa fa-check"></i>Text conventions used in this book</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#other-reading"><i class="fa fa-check"></i>Other reading</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="contributing-to-r4epi.html"><a href="contributing-to-r4epi.html"><i class="fa fa-check"></i>Contributing to R4Epi</a>
<ul>
<li class="chapter" data-level="" data-path="contributing-to-r4epi.html"><a href="contributing-to-r4epi.html#typos"><i class="fa fa-check"></i>Typos</a></li>
<li class="chapter" data-level="" data-path="contributing-to-r4epi.html"><a href="contributing-to-r4epi.html#issues"><i class="fa fa-check"></i>Issues</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="about-the-authors.html"><a href="about-the-authors.html"><i class="fa fa-check"></i>About the Authors</a>
<ul>
<li class="chapter" data-level="" data-path="about-the-authors.html"><a href="about-the-authors.html#brad-cannell"><i class="fa fa-check"></i>Brad Cannell</a></li>
<li class="chapter" data-level="" data-path="about-the-authors.html"><a href="about-the-authors.html#melvin-livingston"><i class="fa fa-check"></i>Melvin Livingston</a></li>
</ul></li>
<li class="part"><span><b>I Getting Started</b></span></li>
<li class="chapter" data-level="1" data-path="installing-r-and-rstudio.html"><a href="installing-r-and-rstudio.html"><i class="fa fa-check"></i><b>1</b> Installing R and RStudio</a>
<ul>
<li class="chapter" data-level="1.1" data-path="installing-r-and-rstudio.html"><a href="installing-r-and-rstudio.html#download-and-install-on-a-mac"><i class="fa fa-check"></i><b>1.1</b> Download and install on a Mac</a></li>
<li class="chapter" data-level="1.2" data-path="installing-r-and-rstudio.html"><a href="installing-r-and-rstudio.html#download-and-install-on-a-pc"><i class="fa fa-check"></i><b>1.2</b> Download and install on a PC</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="what-is-r.html"><a href="what-is-r.html"><i class="fa fa-check"></i><b>2</b> What is R?</a>
<ul>
<li class="chapter" data-level="2.1" data-path="what-is-r.html"><a href="what-is-r.html#what-is-data"><i class="fa fa-check"></i><b>2.1</b> What is data?</a></li>
<li class="chapter" data-level="2.2" data-path="what-is-r.html"><a href="what-is-r.html#what-is-r-1"><i class="fa fa-check"></i><b>2.2</b> What is R?</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="what-is-r.html"><a href="what-is-r.html#transferring-data"><i class="fa fa-check"></i><b>2.2.1</b> Transferring data</a></li>
<li class="chapter" data-level="2.2.2" data-path="what-is-r.html"><a href="what-is-r.html#managing-data"><i class="fa fa-check"></i><b>2.2.2</b> Managing data</a></li>
<li class="chapter" data-level="2.2.3" data-path="what-is-r.html"><a href="what-is-r.html#analyzing-data"><i class="fa fa-check"></i><b>2.2.3</b> Analyzing data</a></li>
<li class="chapter" data-level="2.2.4" data-path="what-is-r.html"><a href="what-is-r.html#presenting-data"><i class="fa fa-check"></i><b>2.2.4</b> Presenting data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="navigating-the-rstudio-interface.html"><a href="navigating-the-rstudio-interface.html"><i class="fa fa-check"></i><b>3</b> Navigating the RStudio interface</a>
<ul>
<li class="chapter" data-level="3.1" data-path="navigating-the-rstudio-interface.html"><a href="navigating-the-rstudio-interface.html#the-console"><i class="fa fa-check"></i><b>3.1</b> The console</a></li>
<li class="chapter" data-level="3.2" data-path="navigating-the-rstudio-interface.html"><a href="navigating-the-rstudio-interface.html#the-environment-pane"><i class="fa fa-check"></i><b>3.2</b> The environment pane</a></li>
<li class="chapter" data-level="3.3" data-path="navigating-the-rstudio-interface.html"><a href="navigating-the-rstudio-interface.html#the-files-pane"><i class="fa fa-check"></i><b>3.3</b> The files pane</a></li>
<li class="chapter" data-level="3.4" data-path="navigating-the-rstudio-interface.html"><a href="navigating-the-rstudio-interface.html#the-source-pane"><i class="fa fa-check"></i><b>3.4</b> The source pane</a></li>
<li class="chapter" data-level="3.5" data-path="navigating-the-rstudio-interface.html"><a href="navigating-the-rstudio-interface.html#rstudio-preferences"><i class="fa fa-check"></i><b>3.5</b> RStudio preferences</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="speaking-rs-language.html"><a href="speaking-rs-language.html"><i class="fa fa-check"></i><b>4</b> Speaking R’s language</a>
<ul>
<li class="chapter" data-level="4.1" data-path="speaking-rs-language.html"><a href="speaking-rs-language.html#r-is-a-language"><i class="fa fa-check"></i><b>4.1</b> R is a <em>language</em></a></li>
<li class="chapter" data-level="4.2" data-path="speaking-rs-language.html"><a href="speaking-rs-language.html#the-r-interpreter"><i class="fa fa-check"></i><b>4.2</b> The R interpreter</a></li>
<li class="chapter" data-level="4.3" data-path="speaking-rs-language.html"><a href="speaking-rs-language.html#errors"><i class="fa fa-check"></i><b>4.3</b> Errors</a></li>
<li class="chapter" data-level="4.4" data-path="speaking-rs-language.html"><a href="speaking-rs-language.html#functions"><i class="fa fa-check"></i><b>4.4</b> Functions</a></li>
<li class="chapter" data-level="4.5" data-path="speaking-rs-language.html"><a href="speaking-rs-language.html#objects"><i class="fa fa-check"></i><b>4.5</b> Objects</a></li>
<li class="chapter" data-level="4.6" data-path="speaking-rs-language.html"><a href="speaking-rs-language.html#comments"><i class="fa fa-check"></i><b>4.6</b> Comments</a></li>
<li class="chapter" data-level="4.7" data-path="speaking-rs-language.html"><a href="speaking-rs-language.html#packages"><i class="fa fa-check"></i><b>4.7</b> Packages</a></li>
<li class="chapter" data-level="4.8" data-path="speaking-rs-language.html"><a href="speaking-rs-language.html#programming-style"><i class="fa fa-check"></i><b>4.8</b> Programming style</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="lets-get-programming.html"><a href="lets-get-programming.html"><i class="fa fa-check"></i><b>5</b> Let’s get programming</a>
<ul>
<li class="chapter" data-level="5.1" data-path="lets-get-programming.html"><a href="lets-get-programming.html#simulating-data"><i class="fa fa-check"></i><b>5.1</b> Simulating data</a></li>
<li class="chapter" data-level="5.2" data-path="lets-get-programming.html"><a href="lets-get-programming.html#vectors"><i class="fa fa-check"></i><b>5.2</b> Vectors</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="lets-get-programming.html"><a href="lets-get-programming.html#vector-types"><i class="fa fa-check"></i><b>5.2.1</b> Vector types</a></li>
<li class="chapter" data-level="5.2.2" data-path="lets-get-programming.html"><a href="lets-get-programming.html#double-vectors"><i class="fa fa-check"></i><b>5.2.2</b> Double vectors</a></li>
<li class="chapter" data-level="5.2.3" data-path="lets-get-programming.html"><a href="lets-get-programming.html#integer-vectors"><i class="fa fa-check"></i><b>5.2.3</b> Integer vectors</a></li>
<li class="chapter" data-level="5.2.4" data-path="lets-get-programming.html"><a href="lets-get-programming.html#logical-vectors"><i class="fa fa-check"></i><b>5.2.4</b> Logical vectors</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="lets-get-programming.html"><a href="lets-get-programming.html#data-frames"><i class="fa fa-check"></i><b>5.3</b> Data frames</a></li>
<li class="chapter" data-level="5.4" data-path="lets-get-programming.html"><a href="lets-get-programming.html#tibbles"><i class="fa fa-check"></i><b>5.4</b> Tibbles</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="lets-get-programming.html"><a href="lets-get-programming.html#the-as_tibble-function"><i class="fa fa-check"></i><b>5.4.1</b> The as_tibble function</a></li>
<li class="chapter" data-level="5.4.2" data-path="lets-get-programming.html"><a href="lets-get-programming.html#the-tibble-function"><i class="fa fa-check"></i><b>5.4.2</b> The tibble function</a></li>
<li class="chapter" data-level="5.4.3" data-path="lets-get-programming.html"><a href="lets-get-programming.html#the-tribble-function"><i class="fa fa-check"></i><b>5.4.3</b> The tribble function</a></li>
<li class="chapter" data-level="5.4.4" data-path="lets-get-programming.html"><a href="lets-get-programming.html#why-use-tibbles"><i class="fa fa-check"></i><b>5.4.4</b> Why use tibbles</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="lets-get-programming.html"><a href="lets-get-programming.html#missing-data"><i class="fa fa-check"></i><b>5.5</b> Missing data</a></li>
<li class="chapter" data-level="5.6" data-path="lets-get-programming.html"><a href="lets-get-programming.html#our-first-analysis"><i class="fa fa-check"></i><b>5.6</b> Our first analysis</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="lets-get-programming.html"><a href="lets-get-programming.html#manual-calculation-of-the-mean"><i class="fa fa-check"></i><b>5.6.1</b> Manual calculation of the mean</a></li>
<li class="chapter" data-level="5.6.2" data-path="lets-get-programming.html"><a href="lets-get-programming.html#dollar-sign-notation"><i class="fa fa-check"></i><b>5.6.2</b> Dollar sign notation</a></li>
<li class="chapter" data-level="5.6.3" data-path="lets-get-programming.html"><a href="lets-get-programming.html#bracket-notation"><i class="fa fa-check"></i><b>5.6.3</b> Bracket notation</a></li>
<li class="chapter" data-level="5.6.4" data-path="lets-get-programming.html"><a href="lets-get-programming.html#the-sum-function"><i class="fa fa-check"></i><b>5.6.4</b> The sum function</a></li>
<li class="chapter" data-level="5.6.5" data-path="lets-get-programming.html"><a href="lets-get-programming.html#nesting-functions"><i class="fa fa-check"></i><b>5.6.5</b> Nesting functions</a></li>
<li class="chapter" data-level="5.6.6" data-path="lets-get-programming.html"><a href="lets-get-programming.html#the-length-function"><i class="fa fa-check"></i><b>5.6.6</b> The length function</a></li>
<li class="chapter" data-level="5.6.7" data-path="lets-get-programming.html"><a href="lets-get-programming.html#the-mean-function"><i class="fa fa-check"></i><b>5.6.7</b> The mean function</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="lets-get-programming.html"><a href="lets-get-programming.html#some-common-errors"><i class="fa fa-check"></i><b>5.7</b> Some common errors</a></li>
<li class="chapter" data-level="5.8" data-path="lets-get-programming.html"><a href="lets-get-programming.html#summary"><i class="fa fa-check"></i><b>5.8</b> Summary</a></li>
</ul></li>
<li class="part"><span><b>II Coding Tools and Best Practices</b></span></li>
<li class="chapter" data-level="6" data-path="r-scripts.html"><a href="r-scripts.html"><i class="fa fa-check"></i><b>6</b> R scripts</a>
<ul>
<li class="chapter" data-level="6.1" data-path="r-scripts.html"><a href="r-scripts.html#creating-r-scripts"><i class="fa fa-check"></i><b>6.1</b> Creating R scripts</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="r-markdown.html"><a href="r-markdown.html"><i class="fa fa-check"></i><b>7</b> R markdown</a>
<ul>
<li class="chapter" data-level="7.1" data-path="r-markdown.html"><a href="r-markdown.html#what-is-r-markdown"><i class="fa fa-check"></i><b>7.1</b> What is R markdown?</a></li>
<li class="chapter" data-level="7.2" data-path="r-markdown.html"><a href="r-markdown.html#why-use-r-markdown"><i class="fa fa-check"></i><b>7.2</b> Why use R markdown?</a></li>
<li class="chapter" data-level="7.3" data-path="r-markdown.html"><a href="r-markdown.html#create-an-r-notebook"><i class="fa fa-check"></i><b>7.3</b> Create an R Notebook</a></li>
<li class="chapter" data-level="7.4" data-path="r-markdown.html"><a href="r-markdown.html#yaml-headers"><i class="fa fa-check"></i><b>7.4</b> YAML headers</a></li>
<li class="chapter" data-level="7.5" data-path="r-markdown.html"><a href="r-markdown.html#r-code-chunks"><i class="fa fa-check"></i><b>7.5</b> R code chunks</a></li>
<li class="chapter" data-level="7.6" data-path="r-markdown.html"><a href="r-markdown.html#markdown"><i class="fa fa-check"></i><b>7.6</b> Markdown</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="r-projects.html"><a href="r-projects.html"><i class="fa fa-check"></i><b>8</b> R projects</a></li>
<li class="chapter" data-level="9" data-path="coding-best-practices.html"><a href="coding-best-practices.html"><i class="fa fa-check"></i><b>9</b> Coding best practices</a>
<ul>
<li class="chapter" data-level="9.1" data-path="coding-best-practices.html"><a href="coding-best-practices.html#general-principles"><i class="fa fa-check"></i><b>9.1</b> General principles</a></li>
<li class="chapter" data-level="9.2" data-path="coding-best-practices.html"><a href="coding-best-practices.html#code-comments"><i class="fa fa-check"></i><b>9.2</b> Code comments</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="coding-best-practices.html"><a href="coding-best-practices.html#defining-key-variables"><i class="fa fa-check"></i><b>9.2.1</b> Defining key variables</a></li>
<li class="chapter" data-level="9.2.2" data-path="coding-best-practices.html"><a href="coding-best-practices.html#what-this-code-is-trying-to-accomplish"><i class="fa fa-check"></i><b>9.2.2</b> What this code is trying to accomplish</a></li>
<li class="chapter" data-level="9.2.3" data-path="coding-best-practices.html"><a href="coding-best-practices.html#why-i-chose-this-particular-strategy"><i class="fa fa-check"></i><b>9.2.3</b> Why I chose this particular strategy</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="coding-best-practices.html"><a href="coding-best-practices.html#style-guidelines"><i class="fa fa-check"></i><b>9.3</b> Style guidelines</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="coding-best-practices.html"><a href="coding-best-practices.html#comments-1"><i class="fa fa-check"></i><b>9.3.1</b> Comments</a></li>
<li class="chapter" data-level="9.3.2" data-path="coding-best-practices.html"><a href="coding-best-practices.html#object-variable-names"><i class="fa fa-check"></i><b>9.3.2</b> Object (variable) names</a></li>
<li class="chapter" data-level="9.3.3" data-path="coding-best-practices.html"><a href="coding-best-practices.html#use-names-that-are-informative"><i class="fa fa-check"></i><b>9.3.3</b> Use names that are informative</a></li>
<li class="chapter" data-level="9.3.4" data-path="coding-best-practices.html"><a href="coding-best-practices.html#file-names"><i class="fa fa-check"></i><b>9.3.4</b> File Names</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="using-pipes.html"><a href="using-pipes.html"><i class="fa fa-check"></i><b>10</b> Using pipes</a>
<ul>
<li class="chapter" data-level="10.1" data-path="using-pipes.html"><a href="using-pipes.html#what-are-pipes"><i class="fa fa-check"></i><b>10.1</b> What are pipes?</a></li>
<li class="chapter" data-level="10.2" data-path="using-pipes.html"><a href="using-pipes.html#how-do-pipes-work"><i class="fa fa-check"></i><b>10.2</b> How do pipes work?</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="using-pipes.html"><a href="using-pipes.html#keyboard-shortcut"><i class="fa fa-check"></i><b>10.2.1</b> Keyboard shortcut</a></li>
<li class="chapter" data-level="10.2.2" data-path="using-pipes.html"><a href="using-pipes.html#pipe-style"><i class="fa fa-check"></i><b>10.2.2</b> Pipe style</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="using-pipes.html"><a href="using-pipes.html#final-thought-on-pipes"><i class="fa fa-check"></i><b>10.3</b> Final thought on pipes</a></li>
</ul></li>
<li class="part"><span><b>III Data Transfer</b></span></li>
<li class="chapter" data-level="11" data-path="introduction-to-data-transfer.html"><a href="introduction-to-data-transfer.html"><i class="fa fa-check"></i><b>11</b> Introduction to data transfer</a></li>
<li class="chapter" data-level="12" data-path="file-paths.html"><a href="file-paths.html"><i class="fa fa-check"></i><b>12</b> File paths</a>
<ul>
<li class="chapter" data-level="12.1" data-path="file-paths.html"><a href="file-paths.html#finding-file-paths"><i class="fa fa-check"></i><b>12.1</b> Finding file paths</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="importing-plain-text-files.html"><a href="importing-plain-text-files.html"><i class="fa fa-check"></i><b>13</b> Importing plain text files</a>
<ul>
<li class="chapter" data-level="13.1" data-path="importing-plain-text-files.html"><a href="importing-plain-text-files.html#packages-for-importing-data"><i class="fa fa-check"></i><b>13.1</b> Packages for importing data</a></li>
<li class="chapter" data-level="13.2" data-path="importing-plain-text-files.html"><a href="importing-plain-text-files.html#importing-space-delimited-files"><i class="fa fa-check"></i><b>13.2</b> Importing space delimited files</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="importing-plain-text-files.html"><a href="importing-plain-text-files.html#specifying-missing-data-values"><i class="fa fa-check"></i><b>13.2.1</b> Specifying missing data values</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="importing-plain-text-files.html"><a href="importing-plain-text-files.html#importing-tab-delimited-files"><i class="fa fa-check"></i><b>13.3</b> Importing tab delimited files</a></li>
<li class="chapter" data-level="13.4" data-path="importing-plain-text-files.html"><a href="importing-plain-text-files.html#importing-fixed-width-format-files"><i class="fa fa-check"></i><b>13.4</b> Importing fixed width format files</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="importing-plain-text-files.html"><a href="importing-plain-text-files.html#vector-of-column-widths"><i class="fa fa-check"></i><b>13.4.1</b> Vector of column widths</a></li>
<li class="chapter" data-level="13.4.2" data-path="importing-plain-text-files.html"><a href="importing-plain-text-files.html#paired-vector-of-start-and-end-positions"><i class="fa fa-check"></i><b>13.4.2</b> Paired vector of start and end positions</a></li>
<li class="chapter" data-level="13.4.3" data-path="importing-plain-text-files.html"><a href="importing-plain-text-files.html#using-named-arguments"><i class="fa fa-check"></i><b>13.4.3</b> Using named arguments</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="importing-plain-text-files.html"><a href="importing-plain-text-files.html#importing-comma-separated-values-files"><i class="fa fa-check"></i><b>13.5</b> Importing comma separated values files</a></li>
<li class="chapter" data-level="13.6" data-path="importing-plain-text-files.html"><a href="importing-plain-text-files.html#additional-arguments"><i class="fa fa-check"></i><b>13.6</b> Additional arguments</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="importing-binary-files.html"><a href="importing-binary-files.html"><i class="fa fa-check"></i><b>14</b> Importing binary files</a>
<ul>
<li class="chapter" data-level="14.1" data-path="importing-binary-files.html"><a href="importing-binary-files.html#packages-for-importing-data-1"><i class="fa fa-check"></i><b>14.1</b> Packages for importing data</a></li>
<li class="chapter" data-level="14.2" data-path="importing-binary-files.html"><a href="importing-binary-files.html#importing-microsoft-excel-spreadsheets"><i class="fa fa-check"></i><b>14.2</b> Importing Microsoft Excel spreadsheets</a></li>
<li class="chapter" data-level="14.3" data-path="importing-binary-files.html"><a href="importing-binary-files.html#importing-data-from-other-statistical-analysis-software"><i class="fa fa-check"></i><b>14.3</b> Importing data from other statistical analysis software</a></li>
<li class="chapter" data-level="14.4" data-path="importing-binary-files.html"><a href="importing-binary-files.html#importing-sas-data-sets"><i class="fa fa-check"></i><b>14.4</b> Importing SAS data sets</a></li>
<li class="chapter" data-level="14.5" data-path="importing-binary-files.html"><a href="importing-binary-files.html#importing-stata-data-sets"><i class="fa fa-check"></i><b>14.5</b> Importing Stata data sets</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="rstudios-data-import-tool.html"><a href="rstudios-data-import-tool.html"><i class="fa fa-check"></i><b>15</b> RStudio’s data import tool</a></li>
<li class="chapter" data-level="16" data-path="exporting-data.html"><a href="exporting-data.html"><i class="fa fa-check"></i><b>16</b> Exporting data</a>
<ul>
<li class="chapter" data-level="16.1" data-path="exporting-data.html"><a href="exporting-data.html#plain-text-files"><i class="fa fa-check"></i><b>16.1</b> Plain text files</a></li>
<li class="chapter" data-level="16.2" data-path="exporting-data.html"><a href="exporting-data.html#r-binary-files"><i class="fa fa-check"></i><b>16.2</b> R binary files</a></li>
</ul></li>
<li class="part"><span><b>IV Descriptive Analysis</b></span></li>
<li class="chapter" data-level="17" data-path="introduction-to-descriptive-analysis.html"><a href="introduction-to-descriptive-analysis.html"><i class="fa fa-check"></i><b>17</b> Introduction to descriptive analysis</a>
<ul>
<li class="chapter" data-level="17.1" data-path="introduction-to-descriptive-analysis.html"><a href="introduction-to-descriptive-analysis.html#what-is-descriptive-analysis-and-why-would-we-do-it"><i class="fa fa-check"></i><b>17.1</b> What is descriptive analysis and why would we do it?</a></li>
<li class="chapter" data-level="17.2" data-path="introduction-to-descriptive-analysis.html"><a href="introduction-to-descriptive-analysis.html#what-kind-of-descriptive-analysis-should-we-perform"><i class="fa fa-check"></i><b>17.2</b> What kind of descriptive analysis should we perform?</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="numerical-descriptions-of-categorical-variables.html"><a href="numerical-descriptions-of-categorical-variables.html"><i class="fa fa-check"></i><b>18</b> Numerical descriptions of categorical variables</a>
<ul>
<li class="chapter" data-level="18.1" data-path="numerical-descriptions-of-categorical-variables.html"><a href="numerical-descriptions-of-categorical-variables.html#factor-vectors"><i class="fa fa-check"></i><b>18.1</b> Factor vectors</a>
<ul>
<li class="chapter" data-level="18.1.1" data-path="numerical-descriptions-of-categorical-variables.html"><a href="numerical-descriptions-of-categorical-variables.html#coerce-a-numeric-variable"><i class="fa fa-check"></i><b>18.1.1</b> Coerce a numeric variable</a></li>
<li class="chapter" data-level="18.1.2" data-path="numerical-descriptions-of-categorical-variables.html"><a href="numerical-descriptions-of-categorical-variables.html#coerce-a-character-variable"><i class="fa fa-check"></i><b>18.1.2</b> Coerce a character variable</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="numerical-descriptions-of-categorical-variables.html"><a href="numerical-descriptions-of-categorical-variables.html#height-and-weight-data"><i class="fa fa-check"></i><b>18.2</b> Height and Weight Data</a>
<ul>
<li class="chapter" data-level="18.2.1" data-path="numerical-descriptions-of-categorical-variables.html"><a href="numerical-descriptions-of-categorical-variables.html#view-the-data"><i class="fa fa-check"></i><b>18.2.1</b> View the data</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="numerical-descriptions-of-categorical-variables.html"><a href="numerical-descriptions-of-categorical-variables.html#calculating-frequencies"><i class="fa fa-check"></i><b>18.3</b> Calculating frequencies</a>
<ul>
<li class="chapter" data-level="18.3.1" data-path="numerical-descriptions-of-categorical-variables.html"><a href="numerical-descriptions-of-categorical-variables.html#the-base-r-table-function"><i class="fa fa-check"></i><b>18.3.1</b> The base R table function</a></li>
<li class="chapter" data-level="18.3.2" data-path="numerical-descriptions-of-categorical-variables.html"><a href="numerical-descriptions-of-categorical-variables.html#the-gmodels-crosstable-function"><i class="fa fa-check"></i><b>18.3.2</b> The gmodels CrossTable function</a></li>
<li class="chapter" data-level="18.3.3" data-path="numerical-descriptions-of-categorical-variables.html"><a href="numerical-descriptions-of-categorical-variables.html#the-tidyverse-way"><i class="fa fa-check"></i><b>18.3.3</b> The tidyverse way</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="numerical-descriptions-of-categorical-variables.html"><a href="numerical-descriptions-of-categorical-variables.html#calculating-percentages"><i class="fa fa-check"></i><b>18.4</b> Calculating percentages</a></li>
<li class="chapter" data-level="18.5" data-path="numerical-descriptions-of-categorical-variables.html"><a href="numerical-descriptions-of-categorical-variables.html#cat-missing-data"><i class="fa fa-check"></i><b>18.5</b> Missing data</a></li>
<li class="chapter" data-level="18.6" data-path="numerical-descriptions-of-categorical-variables.html"><a href="numerical-descriptions-of-categorical-variables.html#formatting-results"><i class="fa fa-check"></i><b>18.6</b> Formatting results</a></li>
<li class="chapter" data-level="18.7" data-path="numerical-descriptions-of-categorical-variables.html"><a href="numerical-descriptions-of-categorical-variables.html#using-freqtables"><i class="fa fa-check"></i><b>18.7</b> Using freqtables</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="measures-of-central-tendency.html"><a href="measures-of-central-tendency.html"><i class="fa fa-check"></i><b>19</b> Measures of central tendency</a>
<ul>
<li class="chapter" data-level="19.1" data-path="measures-of-central-tendency.html"><a href="measures-of-central-tendency.html#calculate-the-mean"><i class="fa fa-check"></i><b>19.1</b> Calculate the mean</a></li>
<li class="chapter" data-level="19.2" data-path="measures-of-central-tendency.html"><a href="measures-of-central-tendency.html#calculate-the-median"><i class="fa fa-check"></i><b>19.2</b> Calculate the median</a></li>
<li class="chapter" data-level="19.3" data-path="measures-of-central-tendency.html"><a href="measures-of-central-tendency.html#calculate-the-mode"><i class="fa fa-check"></i><b>19.3</b> Calculate the mode</a></li>
<li class="chapter" data-level="19.4" data-path="measures-of-central-tendency.html"><a href="measures-of-central-tendency.html#compare-mean-median-and-mode"><i class="fa fa-check"></i><b>19.4</b> Compare mean, median, and mode</a></li>
<li class="chapter" data-level="19.5" data-path="measures-of-central-tendency.html"><a href="measures-of-central-tendency.html#data-checking"><i class="fa fa-check"></i><b>19.5</b> Data checking</a></li>
<li class="chapter" data-level="19.6" data-path="measures-of-central-tendency.html"><a href="measures-of-central-tendency.html#properties-of-mean-median-and-mode"><i class="fa fa-check"></i><b>19.6</b> Properties of mean, median, and mode</a></li>
<li class="chapter" data-level="19.7" data-path="measures-of-central-tendency.html"><a href="measures-of-central-tendency.html#na-rm"><i class="fa fa-check"></i><b>19.7</b> Missing data</a></li>
<li class="chapter" data-level="19.8" data-path="measures-of-central-tendency.html"><a href="measures-of-central-tendency.html#using-meantables"><i class="fa fa-check"></i><b>19.8</b> Using meantables</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="measures-of-dispersion.html"><a href="measures-of-dispersion.html"><i class="fa fa-check"></i><b>20</b> Measures of dispersion</a>
<ul>
<li class="chapter" data-level="20.1" data-path="measures-of-dispersion.html"><a href="measures-of-dispersion.html#comparing-distributions"><i class="fa fa-check"></i><b>20.1</b> Comparing distributions</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="describing-the-relationship-between-a-continuous-outcome-and-a-continuous-predictor.html"><a href="describing-the-relationship-between-a-continuous-outcome-and-a-continuous-predictor.html"><i class="fa fa-check"></i><b>21</b> Describing the relationship between a continuous outcome and a continuous predictor</a>
<ul>
<li class="chapter" data-level="21.1" data-path="describing-the-relationship-between-a-continuous-outcome-and-a-continuous-predictor.html"><a href="describing-the-relationship-between-a-continuous-outcome-and-a-continuous-predictor.html#pearson-correlation-coefficient"><i class="fa fa-check"></i><b>21.1</b> Pearson Correlation Coefficient</a>
<ul>
<li class="chapter" data-level="21.1.1" data-path="describing-the-relationship-between-a-continuous-outcome-and-a-continuous-predictor.html"><a href="describing-the-relationship-between-a-continuous-outcome-and-a-continuous-predictor.html#calculating-r"><i class="fa fa-check"></i><b>21.1.1</b> Calculating r</a></li>
<li class="chapter" data-level="21.1.2" data-path="describing-the-relationship-between-a-continuous-outcome-and-a-continuous-predictor.html"><a href="describing-the-relationship-between-a-continuous-outcome-and-a-continuous-predictor.html#correlation-intuition"><i class="fa fa-check"></i><b>21.1.2</b> Correlation intuition</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="22" data-path="describing-the-relationship-between-a-continuous-outcome-and-a-categorical-predictor.html"><a href="describing-the-relationship-between-a-continuous-outcome-and-a-categorical-predictor.html"><i class="fa fa-check"></i><b>22</b> Describing the relationship between a continuous outcome and a categorical predictor</a>
<ul>
<li class="chapter" data-level="22.1" data-path="describing-the-relationship-between-a-continuous-outcome-and-a-categorical-predictor.html"><a href="describing-the-relationship-between-a-continuous-outcome-and-a-categorical-predictor.html#single-predictor-and-single-outcome"><i class="fa fa-check"></i><b>22.1</b> Single predictor and single outcome</a></li>
<li class="chapter" data-level="22.2" data-path="describing-the-relationship-between-a-continuous-outcome-and-a-categorical-predictor.html"><a href="describing-the-relationship-between-a-continuous-outcome-and-a-categorical-predictor.html#multiple-predictors"><i class="fa fa-check"></i><b>22.2</b> Multiple predictors</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="describing-the-relationship-between-a-categorical-outcome-and-a-categorical-predictor.html"><a href="describing-the-relationship-between-a-categorical-outcome-and-a-categorical-predictor.html"><i class="fa fa-check"></i><b>23</b> Describing the relationship between a categorical outcome and a categorical predictor</a>
<ul>
<li class="chapter" data-level="23.1" data-path="describing-the-relationship-between-a-categorical-outcome-and-a-categorical-predictor.html"><a href="describing-the-relationship-between-a-categorical-outcome-and-a-categorical-predictor.html#comparing-two-variables"><i class="fa fa-check"></i><b>23.1</b> Comparing two variables</a></li>
</ul></li>
<li class="part"><span><b>V Data Management</b></span></li>
<li class="chapter" data-level="24" data-path="introduction-to-data-management.html"><a href="introduction-to-data-management.html"><i class="fa fa-check"></i><b>24</b> Introduction to data management</a>
<ul>
<li class="chapter" data-level="24.1" data-path="introduction-to-data-management.html"><a href="introduction-to-data-management.html#multiple-paradigms-for-data-management-in-r"><i class="fa fa-check"></i><b>24.1</b> Multiple paradigms for data management in R</a></li>
<li class="chapter" data-level="24.2" data-path="introduction-to-data-management.html"><a href="introduction-to-data-management.html#the-dplyr-package"><i class="fa fa-check"></i><b>24.2</b> The dplyr package</a>
<ul>
<li class="chapter" data-level="24.2.1" data-path="introduction-to-data-management.html"><a href="introduction-to-data-management.html#the-dplyr-verbs"><i class="fa fa-check"></i><b>24.2.1</b> The dplyr verbs</a></li>
<li class="chapter" data-level="24.2.2" data-path="introduction-to-data-management.html"><a href="introduction-to-data-management.html#the-.data-argument"><i class="fa fa-check"></i><b>24.2.2</b> The .data argument</a></li>
<li class="chapter" data-level="24.2.3" data-path="introduction-to-data-management.html"><a href="introduction-to-data-management.html#the-argument"><i class="fa fa-check"></i><b>24.2.3</b> The … argument</a></li>
<li class="chapter" data-level="24.2.4" data-path="introduction-to-data-management.html"><a href="introduction-to-data-management.html#non-standard-evaluation"><i class="fa fa-check"></i><b>24.2.4</b> Non-standard evaluation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="25" data-path="creating-and-modifying-columns.html"><a href="creating-and-modifying-columns.html"><i class="fa fa-check"></i><b>25</b> Creating and modifying columns</a>
<ul>
<li class="chapter" data-level="25.1" data-path="creating-and-modifying-columns.html"><a href="creating-and-modifying-columns.html#creating-data-frames"><i class="fa fa-check"></i><b>25.1</b> Creating data frames</a></li>
<li class="chapter" data-level="25.2" data-path="creating-and-modifying-columns.html"><a href="creating-and-modifying-columns.html#dollar-sign-notation-1"><i class="fa fa-check"></i><b>25.2</b> Dollar sign notation</a></li>
<li class="chapter" data-level="25.3" data-path="creating-and-modifying-columns.html"><a href="creating-and-modifying-columns.html#bracket-notation-1"><i class="fa fa-check"></i><b>25.3</b> Bracket notation</a></li>
<li class="chapter" data-level="25.4" data-path="creating-and-modifying-columns.html"><a href="creating-and-modifying-columns.html#modify-individual-values"><i class="fa fa-check"></i><b>25.4</b> Modify individual values</a></li>
<li class="chapter" data-level="25.5" data-path="creating-and-modifying-columns.html"><a href="creating-and-modifying-columns.html#the-mutate-function"><i class="fa fa-check"></i><b>25.5</b> The mutate() function</a>
<ul>
<li class="chapter" data-level="25.5.1" data-path="creating-and-modifying-columns.html"><a href="creating-and-modifying-columns.html#adding-or-modifying-a-single-column"><i class="fa fa-check"></i><b>25.5.1</b> Adding or modifying a single column</a></li>
<li class="chapter" data-level="25.5.2" data-path="creating-and-modifying-columns.html"><a href="creating-and-modifying-columns.html#recycling-rules"><i class="fa fa-check"></i><b>25.5.2</b> Recycling rules</a></li>
<li class="chapter" data-level="25.5.3" data-path="creating-and-modifying-columns.html"><a href="creating-and-modifying-columns.html#using-existing-variables-in-name-value-pairs"><i class="fa fa-check"></i><b>25.5.3</b> Using existing variables in name-value pairs</a></li>
<li class="chapter" data-level="25.5.4" data-path="creating-and-modifying-columns.html"><a href="creating-and-modifying-columns.html#adding-or-modifying-multiple-columns"><i class="fa fa-check"></i><b>25.5.4</b> Adding or modifying multiple columns</a></li>
<li class="chapter" data-level="25.5.5" data-path="creating-and-modifying-columns.html"><a href="creating-and-modifying-columns.html#rowwise-mutations"><i class="fa fa-check"></i><b>25.5.5</b> Rowwise mutations</a></li>
<li class="chapter" data-level="25.5.6" data-path="creating-and-modifying-columns.html"><a href="creating-and-modifying-columns.html#group_by-mutations"><i class="fa fa-check"></i><b>25.5.6</b> Group_by mutations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="26" data-path="subsetting-data-frames.html"><a href="subsetting-data-frames.html"><i class="fa fa-check"></i><b>26</b> Subsetting data frames</a>
<ul>
<li class="chapter" data-level="26.1" data-path="subsetting-data-frames.html"><a href="subsetting-data-frames.html#the-select-function"><i class="fa fa-check"></i><b>26.1</b> The select() function</a></li>
<li class="chapter" data-level="26.2" data-path="subsetting-data-frames.html"><a href="subsetting-data-frames.html#the-rename-function"><i class="fa fa-check"></i><b>26.2</b> The rename() function</a></li>
<li class="chapter" data-level="26.3" data-path="subsetting-data-frames.html"><a href="subsetting-data-frames.html#the-filter-function"><i class="fa fa-check"></i><b>26.3</b> The filter() function</a>
<ul>
<li class="chapter" data-level="26.3.1" data-path="subsetting-data-frames.html"><a href="subsetting-data-frames.html#subgroup-analysis"><i class="fa fa-check"></i><b>26.3.1</b> Subgroup analysis</a></li>
<li class="chapter" data-level="26.3.2" data-path="subsetting-data-frames.html"><a href="subsetting-data-frames.html#complete-case-analysis"><i class="fa fa-check"></i><b>26.3.2</b> Complete case analysis</a></li>
</ul></li>
<li class="chapter" data-level="26.4" data-path="subsetting-data-frames.html"><a href="subsetting-data-frames.html#deduplication"><i class="fa fa-check"></i><b>26.4</b> Deduplication</a>
<ul>
<li class="chapter" data-level="26.4.1" data-path="subsetting-data-frames.html"><a href="subsetting-data-frames.html#the-distinct-function"><i class="fa fa-check"></i><b>26.4.1</b> The distinct() function</a></li>
<li class="chapter" data-level="26.4.2" data-path="subsetting-data-frames.html"><a href="subsetting-data-frames.html#complete-duplicate-row-add-tag"><i class="fa fa-check"></i><b>26.4.2</b> Complete duplicate row add tag</a></li>
<li class="chapter" data-level="26.4.3" data-path="subsetting-data-frames.html"><a href="subsetting-data-frames.html#partial-duplicate-rows"><i class="fa fa-check"></i><b>26.4.3</b> Partial duplicate rows</a></li>
<li class="chapter" data-level="26.4.4" data-path="subsetting-data-frames.html"><a href="subsetting-data-frames.html#partial-duplicate-rows---add-tag"><i class="fa fa-check"></i><b>26.4.4</b> Partial duplicate rows - add tag</a></li>
<li class="chapter" data-level="26.4.5" data-path="subsetting-data-frames.html"><a href="subsetting-data-frames.html#count-the-number-of-duplicates"><i class="fa fa-check"></i><b>26.4.5</b> Count the number of duplicates</a></li>
<li class="chapter" data-level="26.4.6" data-path="subsetting-data-frames.html"><a href="subsetting-data-frames.html#what-to-do-about-duplicates"><i class="fa fa-check"></i><b>26.4.6</b> What to do about duplicates</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="27" data-path="working-with-dates.html"><a href="working-with-dates.html"><i class="fa fa-check"></i><b>27</b> Working with dates</a>
<ul>
<li class="chapter" data-level="27.1" data-path="working-with-dates.html"><a href="working-with-dates.html#date-vector-types"><i class="fa fa-check"></i><b>27.1</b> Date vector types</a></li>
<li class="chapter" data-level="27.2" data-path="working-with-dates.html"><a href="working-with-dates.html#dates-under-the-hood"><i class="fa fa-check"></i><b>27.2</b> Dates under the hood</a></li>
<li class="chapter" data-level="27.3" data-path="working-with-dates.html"><a href="working-with-dates.html#coercing-date-times-to-dates"><i class="fa fa-check"></i><b>27.3</b> Coercing date-times to dates</a></li>
<li class="chapter" data-level="27.4" data-path="working-with-dates.html"><a href="working-with-dates.html#coercing-character-strings-to-dates"><i class="fa fa-check"></i><b>27.4</b> Coercing character strings to dates</a></li>
<li class="chapter" data-level="27.5" data-path="working-with-dates.html"><a href="working-with-dates.html#change-the-appearance-of-dates-with-format"><i class="fa fa-check"></i><b>27.5</b> Change the appearance of dates with format()</a></li>
<li class="chapter" data-level="27.6" data-path="working-with-dates.html"><a href="working-with-dates.html#some-useful-built-in-dates"><i class="fa fa-check"></i><b>27.6</b> Some useful built-in dates</a>
<ul>
<li class="chapter" data-level="27.6.1" data-path="working-with-dates.html"><a href="working-with-dates.html#todays-date"><i class="fa fa-check"></i><b>27.6.1</b> Today’s date</a></li>
<li class="chapter" data-level="27.6.2" data-path="working-with-dates.html"><a href="working-with-dates.html#todays-date-time"><i class="fa fa-check"></i><b>27.6.2</b> Today’s date-time</a></li>
<li class="chapter" data-level="27.6.3" data-path="working-with-dates.html"><a href="working-with-dates.html#character-vector-of-full-month-names"><i class="fa fa-check"></i><b>27.6.3</b> Character vector of full month names</a></li>
<li class="chapter" data-level="27.6.4" data-path="working-with-dates.html"><a href="working-with-dates.html#character-vector-of-abbreviated-month-names"><i class="fa fa-check"></i><b>27.6.4</b> Character vector of abbreviated month names</a></li>
<li class="chapter" data-level="27.6.5" data-path="working-with-dates.html"><a href="working-with-dates.html#creating-a-vector-containing-a-sequence-of-dates"><i class="fa fa-check"></i><b>27.6.5</b> Creating a vector containing a sequence of dates</a></li>
</ul></li>
<li class="chapter" data-level="27.7" data-path="working-with-dates.html"><a href="working-with-dates.html#calculating-date-intervals"><i class="fa fa-check"></i><b>27.7</b> Calculating date intervals</a>
<ul>
<li class="chapter" data-level="27.7.1" data-path="working-with-dates.html"><a href="working-with-dates.html#calculate-age-as-the-difference-in-time-between-dob-and-today"><i class="fa fa-check"></i><b>27.7.1</b> Calculate age as the difference in time between dob and today</a></li>
<li class="chapter" data-level="27.7.2" data-path="working-with-dates.html"><a href="working-with-dates.html#rounding-time-intervals"><i class="fa fa-check"></i><b>27.7.2</b> Rounding time intervals</a></li>
</ul></li>
<li class="chapter" data-level="27.8" data-path="working-with-dates.html"><a href="working-with-dates.html#extracting-out-date-parts"><i class="fa fa-check"></i><b>27.8</b> Extracting out date parts</a></li>
<li class="chapter" data-level="27.9" data-path="working-with-dates.html"><a href="working-with-dates.html#sorting-dates"><i class="fa fa-check"></i><b>27.9</b> Sorting dates</a></li>
</ul></li>
<li class="chapter" data-level="28" data-path="working-with-character-strings.html"><a href="working-with-character-strings.html"><i class="fa fa-check"></i><b>28</b> Working with character strings</a>
<ul>
<li class="chapter" data-level="28.1" data-path="working-with-character-strings.html"><a href="working-with-character-strings.html#coerce-to-lowercase"><i class="fa fa-check"></i><b>28.1</b> Coerce to lowercase</a>
<ul>
<li class="chapter" data-level="28.1.1" data-path="working-with-character-strings.html"><a href="working-with-character-strings.html#lowercase"><i class="fa fa-check"></i><b>28.1.1</b> Lowercase</a></li>
<li class="chapter" data-level="28.1.2" data-path="working-with-character-strings.html"><a href="working-with-character-strings.html#upper-case"><i class="fa fa-check"></i><b>28.1.2</b> Upper case</a></li>
<li class="chapter" data-level="28.1.3" data-path="working-with-character-strings.html"><a href="working-with-character-strings.html#title-case"><i class="fa fa-check"></i><b>28.1.3</b> Title case</a></li>
<li class="chapter" data-level="28.1.4" data-path="working-with-character-strings.html"><a href="working-with-character-strings.html#sentence-case"><i class="fa fa-check"></i><b>28.1.4</b> Sentence case</a></li>
</ul></li>
<li class="chapter" data-level="28.2" data-path="working-with-character-strings.html"><a href="working-with-character-strings.html#trim-white-space"><i class="fa fa-check"></i><b>28.2</b> Trim white space</a></li>
<li class="chapter" data-level="28.3" data-path="working-with-character-strings.html"><a href="working-with-character-strings.html#regular-expressions"><i class="fa fa-check"></i><b>28.3</b> Regular expressions</a>
<ul>
<li class="chapter" data-level="28.3.1" data-path="working-with-character-strings.html"><a href="working-with-character-strings.html#remove-the-comma"><i class="fa fa-check"></i><b>28.3.1</b> Remove the comma</a></li>
<li class="chapter" data-level="28.3.2" data-path="working-with-character-strings.html"><a href="working-with-character-strings.html#remove-middle-initial"><i class="fa fa-check"></i><b>28.3.2</b> Remove middle initial</a></li>
<li class="chapter" data-level="28.3.3" data-path="working-with-character-strings.html"><a href="working-with-character-strings.html#remove-double-spaces"><i class="fa fa-check"></i><b>28.3.3</b> Remove double spaces</a></li>
</ul></li>
<li class="chapter" data-level="28.4" data-path="working-with-character-strings.html"><a href="working-with-character-strings.html#separate-values-into-component-parts"><i class="fa fa-check"></i><b>28.4</b> Separate values into component parts</a></li>
<li class="chapter" data-level="28.5" data-path="working-with-character-strings.html"><a href="working-with-character-strings.html#dummy-variables"><i class="fa fa-check"></i><b>28.5</b> Dummy variables</a></li>
</ul></li>
<li class="chapter" data-level="29" data-path="conditional-operations.html"><a href="conditional-operations.html"><i class="fa fa-check"></i><b>29</b> Conditional operations</a>
<ul>
<li class="chapter" data-level="29.1" data-path="conditional-operations.html"><a href="conditional-operations.html#operands-and-operators"><i class="fa fa-check"></i><b>29.1</b> Operands and operators</a></li>
<li class="chapter" data-level="29.2" data-path="conditional-operations.html"><a href="conditional-operations.html#testing-multiple-conditions-simultaneously"><i class="fa fa-check"></i><b>29.2</b> Testing multiple conditions simultaneously</a></li>
<li class="chapter" data-level="29.3" data-path="conditional-operations.html"><a href="conditional-operations.html#testing-a-sequence-of-conditions"><i class="fa fa-check"></i><b>29.3</b> Testing a sequence of conditions</a></li>
<li class="chapter" data-level="29.4" data-path="conditional-operations.html"><a href="conditional-operations.html#recoding-variables"><i class="fa fa-check"></i><b>29.4</b> Recoding variables</a></li>
<li class="chapter" data-level="29.5" data-path="conditional-operations.html"><a href="conditional-operations.html#case_when-is-lazy"><i class="fa fa-check"></i><b>29.5</b> case_when() is lazy</a></li>
<li class="chapter" data-level="29.6" data-path="conditional-operations.html"><a href="conditional-operations.html#recode-missing"><i class="fa fa-check"></i><b>29.6</b> Recode missing</a></li>
</ul></li>
<li class="chapter" data-level="30" data-path="working-with-multiple-data-frames.html"><a href="working-with-multiple-data-frames.html"><i class="fa fa-check"></i><b>30</b> Working with multiple data frames</a>
<ul>
<li class="chapter" data-level="30.1" data-path="working-with-multiple-data-frames.html"><a href="working-with-multiple-data-frames.html#combining-data-frames-vertically-adding-rows"><i class="fa fa-check"></i><b>30.1</b> Combining data frames vertically: Adding rows</a>
<ul>
<li class="chapter" data-level="30.1.1" data-path="working-with-multiple-data-frames.html"><a href="working-with-multiple-data-frames.html#combining-more-than-2-data-frames"><i class="fa fa-check"></i><b>30.1.1</b> Combining more than 2 data frames</a></li>
<li class="chapter" data-level="30.1.2" data-path="working-with-multiple-data-frames.html"><a href="working-with-multiple-data-frames.html#adding-rows-with-differing-columns"><i class="fa fa-check"></i><b>30.1.2</b> Adding rows with differing columns</a></li>
<li class="chapter" data-level="30.1.3" data-path="working-with-multiple-data-frames.html"><a href="working-with-multiple-data-frames.html#differing-column-positions"><i class="fa fa-check"></i><b>30.1.3</b> Differing column positions</a></li>
<li class="chapter" data-level="30.1.4" data-path="working-with-multiple-data-frames.html"><a href="working-with-multiple-data-frames.html#differing-column-names"><i class="fa fa-check"></i><b>30.1.4</b> Differing column names</a></li>
</ul></li>
<li class="chapter" data-level="30.2" data-path="working-with-multiple-data-frames.html"><a href="working-with-multiple-data-frames.html#combining-data-frames-horizontally-adding-columns"><i class="fa fa-check"></i><b>30.2</b> Combining data frames horizontally: Adding columns</a>
<ul>
<li class="chapter" data-level="30.2.1" data-path="working-with-multiple-data-frames.html"><a href="working-with-multiple-data-frames.html#combining-data-frames-horizontally-by-position"><i class="fa fa-check"></i><b>30.2.1</b> Combining data frames horizontally by position</a></li>
<li class="chapter" data-level="30.2.2" data-path="working-with-multiple-data-frames.html"><a href="working-with-multiple-data-frames.html#combining-data-frames-horizontally-by-key-values"><i class="fa fa-check"></i><b>30.2.2</b> Combining data frames horizontally by key values</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="31" data-path="restructuring-data-frames.html"><a href="restructuring-data-frames.html"><i class="fa fa-check"></i><b>31</b> Restructuring data frames</a>
<ul>
<li class="chapter" data-level="31.1" data-path="restructuring-data-frames.html"><a href="restructuring-data-frames.html#the-tidyr-package"><i class="fa fa-check"></i><b>31.1</b> The tidyr package</a></li>
<li class="chapter" data-level="31.2" data-path="restructuring-data-frames.html"><a href="restructuring-data-frames.html#pivoting-longer"><i class="fa fa-check"></i><b>31.2</b> Pivoting longer</a>
<ul>
<li class="chapter" data-level="31.2.1" data-path="restructuring-data-frames.html"><a href="restructuring-data-frames.html#the-names_to-argument"><i class="fa fa-check"></i><b>31.2.1</b> The names_to argument</a></li>
<li class="chapter" data-level="31.2.2" data-path="restructuring-data-frames.html"><a href="restructuring-data-frames.html#the-names_prefix-argument"><i class="fa fa-check"></i><b>31.2.2</b> The names_prefix argument</a></li>
<li class="chapter" data-level="31.2.3" data-path="restructuring-data-frames.html"><a href="restructuring-data-frames.html#the-values_to-argument"><i class="fa fa-check"></i><b>31.2.3</b> The values_to argument</a></li>
<li class="chapter" data-level="31.2.4" data-path="restructuring-data-frames.html"><a href="restructuring-data-frames.html#the-names_transform-argument"><i class="fa fa-check"></i><b>31.2.4</b> The names_transform argument</a></li>
<li class="chapter" data-level="31.2.5" data-path="restructuring-data-frames.html"><a href="restructuring-data-frames.html#pivoting-multiple-sets-of-columns"><i class="fa fa-check"></i><b>31.2.5</b> Pivoting multiple sets of columns</a></li>
<li class="chapter" data-level="31.2.6" data-path="restructuring-data-frames.html"><a href="restructuring-data-frames.html#the-names_sep-argument"><i class="fa fa-check"></i><b>31.2.6</b> The names_sep argument</a></li>
<li class="chapter" data-level="31.2.7" data-path="restructuring-data-frames.html"><a href="restructuring-data-frames.html#the-.value-special-value"><i class="fa fa-check"></i><b>31.2.7</b> The .value special value</a></li>
<li class="chapter" data-level="31.2.8" data-path="restructuring-data-frames.html"><a href="restructuring-data-frames.html#why-person-period"><i class="fa fa-check"></i><b>31.2.8</b> Why person-period?</a></li>
</ul></li>
<li class="chapter" data-level="31.3" data-path="restructuring-data-frames.html"><a href="restructuring-data-frames.html#pivoting-wider"><i class="fa fa-check"></i><b>31.3</b> Pivoting wider</a>
<ul>
<li class="chapter" data-level="31.3.1" data-path="restructuring-data-frames.html"><a href="restructuring-data-frames.html#why-person-level"><i class="fa fa-check"></i><b>31.3.1</b> Why person-level?</a></li>
</ul></li>
<li class="chapter" data-level="31.4" data-path="restructuring-data-frames.html"><a href="restructuring-data-frames.html#pivoting-summary-statistics"><i class="fa fa-check"></i><b>31.4</b> Pivoting summary statistics</a>
<ul>
<li class="chapter" data-level="31.4.1" data-path="restructuring-data-frames.html"><a href="restructuring-data-frames.html#pivoting-summary-statistics-wide-to-long"><i class="fa fa-check"></i><b>31.4.1</b> Pivoting summary statistics wide to long</a></li>
<li class="chapter" data-level="31.4.2" data-path="restructuring-data-frames.html"><a href="restructuring-data-frames.html#pivoting-summary-statistics-long-to-wide"><i class="fa fa-check"></i><b>31.4.2</b> Pivoting summary statistics long to wide</a></li>
</ul></li>
<li class="chapter" data-level="31.5" data-path="restructuring-data-frames.html"><a href="restructuring-data-frames.html#tidy-data"><i class="fa fa-check"></i><b>31.5</b> Tidy data</a>
<ul>
<li class="chapter" data-level="31.5.1" data-path="restructuring-data-frames.html"><a href="restructuring-data-frames.html#each-variable-must-have-its-own-column"><i class="fa fa-check"></i><b>31.5.1</b> Each variable must have its own column</a></li>
<li class="chapter" data-level="31.5.2" data-path="restructuring-data-frames.html"><a href="restructuring-data-frames.html#each-observation-must-have-its-own-row"><i class="fa fa-check"></i><b>31.5.2</b> Each observation must have its own row</a></li>
<li class="chapter" data-level="31.5.3" data-path="restructuring-data-frames.html"><a href="restructuring-data-frames.html#each-value-must-have-its-own-cell"><i class="fa fa-check"></i><b>31.5.3</b> Each value must have its own cell</a></li>
</ul></li>
<li class="chapter" data-level="31.6" data-path="restructuring-data-frames.html"><a href="restructuring-data-frames.html#the-complete-function"><i class="fa fa-check"></i><b>31.6</b> The complete() function</a></li>
</ul></li>
<li class="part"><span><b>VI Repeated Operations</b></span></li>
<li class="chapter" data-level="32" data-path="introduction-to-repeated-operations.html"><a href="introduction-to-repeated-operations.html"><i class="fa fa-check"></i><b>32</b> Introduction to repeated operations</a>
<ul>
<li class="chapter" data-level="32.1" data-path="introduction-to-repeated-operations.html"><a href="introduction-to-repeated-operations.html#multiple-methods-for-repeated-operations-in-r"><i class="fa fa-check"></i><b>32.1</b> Multiple methods for repeated operations in R</a></li>
<li class="chapter" data-level="32.2" data-path="introduction-to-repeated-operations.html"><a href="introduction-to-repeated-operations.html#tidy-evaluation"><i class="fa fa-check"></i><b>32.2</b> Tidy evaluation</a></li>
</ul></li>
<li class="chapter" data-level="33" data-path="writing-functions.html"><a href="writing-functions.html"><i class="fa fa-check"></i><b>33</b> Writing functions</a>
<ul>
<li class="chapter" data-level="33.1" data-path="writing-functions.html"><a href="writing-functions.html#when-to-write-functions"><i class="fa fa-check"></i><b>33.1</b> When to write functions</a></li>
<li class="chapter" data-level="33.2" data-path="writing-functions.html"><a href="writing-functions.html#how-to-write-functions"><i class="fa fa-check"></i><b>33.2</b> How to write functions</a>
<ul>
<li class="chapter" data-level="33.2.1" data-path="writing-functions.html"><a href="writing-functions.html#the-function-function"><i class="fa fa-check"></i><b>33.2.1</b> The function() function</a></li>
<li class="chapter" data-level="33.2.2" data-path="writing-functions.html"><a href="writing-functions.html#the-function-writing-process"><i class="fa fa-check"></i><b>33.2.2</b> The function writing process</a></li>
</ul></li>
<li class="chapter" data-level="33.3" data-path="writing-functions.html"><a href="writing-functions.html#giving-your-function-arguments-default-values"><i class="fa fa-check"></i><b>33.3</b> Giving your function arguments default values</a></li>
<li class="chapter" data-level="33.4" data-path="writing-functions.html"><a href="writing-functions.html#the-values-your-functions-return"><i class="fa fa-check"></i><b>33.4</b> The values your functions return</a></li>
<li class="chapter" data-level="33.5" data-path="writing-functions.html"><a href="writing-functions.html#lexical-scoping-and-functions"><i class="fa fa-check"></i><b>33.5</b> Lexical scoping and functions</a></li>
<li class="chapter" data-level="33.6" data-path="writing-functions.html"><a href="writing-functions.html#tidy-evaluation-1"><i class="fa fa-check"></i><b>33.6</b> Tidy evaluation</a></li>
</ul></li>
<li class="chapter" data-level="34" data-path="column-wise-operations-in-dplyr.html"><a href="column-wise-operations-in-dplyr.html"><i class="fa fa-check"></i><b>34</b> Column-wise operations in dplyr</a>
<ul>
<li class="chapter" data-level="34.1" data-path="column-wise-operations-in-dplyr.html"><a href="column-wise-operations-in-dplyr.html#the-across-function"><i class="fa fa-check"></i><b>34.1</b> The across() function</a></li>
<li class="chapter" data-level="34.2" data-path="column-wise-operations-in-dplyr.html"><a href="column-wise-operations-in-dplyr.html#across-with-filter"><i class="fa fa-check"></i><b>34.2</b> Across with filter</a></li>
<li class="chapter" data-level="34.3" data-path="column-wise-operations-in-dplyr.html"><a href="column-wise-operations-in-dplyr.html#across-with-mutate"><i class="fa fa-check"></i><b>34.3</b> Across with mutate</a></li>
<li class="chapter" data-level="34.4" data-path="column-wise-operations-in-dplyr.html"><a href="column-wise-operations-in-dplyr.html#across-with-summarise"><i class="fa fa-check"></i><b>34.4</b> Across with summarise</a></li>
</ul></li>
<li class="chapter" data-level="35" data-path="writing-for-loops.html"><a href="writing-for-loops.html"><i class="fa fa-check"></i><b>35</b> Writing for loops</a>
<ul>
<li class="chapter" data-level="35.1" data-path="writing-for-loops.html"><a href="writing-for-loops.html#how-to-write-for-loops"><i class="fa fa-check"></i><b>35.1</b> How to write for loops</a>
<ul>
<li class="chapter" data-level="35.1.1" data-path="writing-for-loops.html"><a href="writing-for-loops.html#the-for-loop-body"><i class="fa fa-check"></i><b>35.1.1</b> The for loop body</a></li>
<li class="chapter" data-level="35.1.2" data-path="writing-for-loops.html"><a href="writing-for-loops.html#the-for-function"><i class="fa fa-check"></i><b>35.1.2</b> The for() function</a></li>
</ul></li>
<li class="chapter" data-level="35.2" data-path="writing-for-loops.html"><a href="writing-for-loops.html#using-for-loops-for-data-transfer"><i class="fa fa-check"></i><b>35.2</b> Using for loops for data transfer</a></li>
<li class="chapter" data-level="35.3" data-path="writing-for-loops.html"><a href="writing-for-loops.html#using-for-loops-for-data-management"><i class="fa fa-check"></i><b>35.3</b> Using for loops for data management</a></li>
<li class="chapter" data-level="35.4" data-path="writing-for-loops.html"><a href="writing-for-loops.html#using-for-loops-for-analysis"><i class="fa fa-check"></i><b>35.4</b> Using for loops for analysis</a></li>
</ul></li>
<li class="chapter" data-level="36" data-path="using-the-purrr-package.html"><a href="using-the-purrr-package.html"><i class="fa fa-check"></i><b>36</b> Using the purrr package</a>
<ul>
<li class="chapter" data-level="36.1" data-path="using-the-purrr-package.html"><a href="using-the-purrr-package.html#comparing-for-loops-and-the-map-functions"><i class="fa fa-check"></i><b>36.1</b> Comparing for loops and the map functions</a></li>
<li class="chapter" data-level="36.2" data-path="using-the-purrr-package.html"><a href="using-the-purrr-package.html#using-purrr-for-data-transfer"><i class="fa fa-check"></i><b>36.2</b> Using purrr for data transfer</a>
<ul>
<li class="chapter" data-level="36.2.1" data-path="using-the-purrr-package.html"><a href="using-the-purrr-package.html#example-1-importing-multiple-sheets-from-an-excel-workbook"><i class="fa fa-check"></i><b>36.2.1</b> Example 1: Importing multiple sheets from an Excel workbook</a></li>
<li class="chapter" data-level="36.2.2" data-path="using-the-purrr-package.html"><a href="using-the-purrr-package.html#why-walk-instead-of-map"><i class="fa fa-check"></i><b>36.2.2</b> Why walk instead of map?</a></li>
<li class="chapter" data-level="36.2.3" data-path="using-the-purrr-package.html"><a href="using-the-purrr-package.html#why-we-didnt-assign-the-return-value-of-walk-to-an-object"><i class="fa fa-check"></i><b>36.2.3</b> why we didn’t assign the return value of <code>walk()</code> to an object?</a></li>
</ul></li>
<li class="chapter" data-level="36.3" data-path="using-the-purrr-package.html"><a href="using-the-purrr-package.html#using-purrr-for-data-management"><i class="fa fa-check"></i><b>36.3</b> Using purrr for data management</a>
<ul>
<li class="chapter" data-level="36.3.1" data-path="using-the-purrr-package.html"><a href="using-the-purrr-package.html#example-1-adding-na-at-multiple-positions"><i class="fa fa-check"></i><b>36.3.1</b> Example 1: Adding NA at multiple positions</a></li>
<li class="chapter" data-level="36.3.2" data-path="using-the-purrr-package.html"><a href="using-the-purrr-package.html#example-2.-detecting-matching-values-by-position"><i class="fa fa-check"></i><b>36.3.2</b> Example 2. Detecting matching values by position</a></li>
</ul></li>
<li class="chapter" data-level="36.4" data-path="using-the-purrr-package.html"><a href="using-the-purrr-package.html#using-purrr-for-analysis"><i class="fa fa-check"></i><b>36.4</b> Using purrr for analysis</a>
<ul>
<li class="chapter" data-level="36.4.1" data-path="using-the-purrr-package.html"><a href="using-the-purrr-package.html#example-1-continuous-statistics"><i class="fa fa-check"></i><b>36.4.1</b> Example 1: Continuous statistics</a></li>
<li class="chapter" data-level="36.4.2" data-path="using-the-purrr-package.html"><a href="using-the-purrr-package.html#example-2-categorical-statistics"><i class="fa fa-check"></i><b>36.4.2</b> Example 2: Categorical statistics</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>VII Presenting Results</b></span></li>
<li class="chapter" data-level="37" data-path="creating-tables-with-r-and-microsoft-word.html"><a href="creating-tables-with-r-and-microsoft-word.html"><i class="fa fa-check"></i><b>37</b> Creating tables with R and Microsoft Word</a>
<ul>
<li class="chapter" data-level="37.1" data-path="creating-tables-with-r-and-microsoft-word.html"><a href="creating-tables-with-r-and-microsoft-word.html#table-1"><i class="fa fa-check"></i><b>37.1</b> Table 1</a></li>
<li class="chapter" data-level="37.2" data-path="creating-tables-with-r-and-microsoft-word.html"><a href="creating-tables-with-r-and-microsoft-word.html#opioid-drug-use"><i class="fa fa-check"></i><b>37.2</b> Opioid drug use</a></li>
<li class="chapter" data-level="37.3" data-path="creating-tables-with-r-and-microsoft-word.html"><a href="creating-tables-with-r-and-microsoft-word.html#table-columns"><i class="fa fa-check"></i><b>37.3</b> Table columns</a></li>
<li class="chapter" data-level="37.4" data-path="creating-tables-with-r-and-microsoft-word.html"><a href="creating-tables-with-r-and-microsoft-word.html#table-rows"><i class="fa fa-check"></i><b>37.4</b> Table rows</a></li>
<li class="chapter" data-level="37.5" data-path="creating-tables-with-r-and-microsoft-word.html"><a href="creating-tables-with-r-and-microsoft-word.html#make-the-table-skeleton"><i class="fa fa-check"></i><b>37.5</b> Make the table skeleton</a></li>
<li class="chapter" data-level="37.6" data-path="creating-tables-with-r-and-microsoft-word.html"><a href="creating-tables-with-r-and-microsoft-word.html#fill-in-column-headers"><i class="fa fa-check"></i><b>37.6</b> Fill in column headers</a>
<ul>
<li class="chapter" data-level="37.6.1" data-path="creating-tables-with-r-and-microsoft-word.html"><a href="creating-tables-with-r-and-microsoft-word.html#group-sample-sizes"><i class="fa fa-check"></i><b>37.6.1</b> Group sample sizes</a></li>
<li class="chapter" data-level="37.6.2" data-path="creating-tables-with-r-and-microsoft-word.html"><a href="creating-tables-with-r-and-microsoft-word.html#formatting-column-headers"><i class="fa fa-check"></i><b>37.6.2</b> Formatting column headers</a></li>
</ul></li>
<li class="chapter" data-level="37.7" data-path="creating-tables-with-r-and-microsoft-word.html"><a href="creating-tables-with-r-and-microsoft-word.html#fill-in-row-headers"><i class="fa fa-check"></i><b>37.7</b> Fill in row headers</a>
<ul>
<li class="chapter" data-level="37.7.1" data-path="creating-tables-with-r-and-microsoft-word.html"><a href="creating-tables-with-r-and-microsoft-word.html#label-statistics"><i class="fa fa-check"></i><b>37.7.1</b> Label statistics</a></li>
<li class="chapter" data-level="37.7.2" data-path="creating-tables-with-r-and-microsoft-word.html"><a href="creating-tables-with-r-and-microsoft-word.html#formatting-row-headers"><i class="fa fa-check"></i><b>37.7.2</b> Formatting row headers</a></li>
</ul></li>
<li class="chapter" data-level="37.8" data-path="creating-tables-with-r-and-microsoft-word.html"><a href="creating-tables-with-r-and-microsoft-word.html#fill-in-data-values"><i class="fa fa-check"></i><b>37.8</b> Fill in data values</a>
<ul>
<li class="chapter" data-level="37.8.1" data-path="creating-tables-with-r-and-microsoft-word.html"><a href="creating-tables-with-r-and-microsoft-word.html#manually-type-values"><i class="fa fa-check"></i><b>37.8.1</b> Manually type values</a></li>
<li class="chapter" data-level="37.8.2" data-path="creating-tables-with-r-and-microsoft-word.html"><a href="creating-tables-with-r-and-microsoft-word.html#copy-and-paste-values"><i class="fa fa-check"></i><b>37.8.2</b> Copy and paste values</a></li>
<li class="chapter" data-level="37.8.3" data-path="creating-tables-with-r-and-microsoft-word.html"><a href="creating-tables-with-r-and-microsoft-word.html#knit-a-word-document"><i class="fa fa-check"></i><b>37.8.3</b> Knit a Word document</a></li>
<li class="chapter" data-level="37.8.4" data-path="creating-tables-with-r-and-microsoft-word.html"><a href="creating-tables-with-r-and-microsoft-word.html#flextable-and-officer"><i class="fa fa-check"></i><b>37.8.4</b> flextable and officer</a></li>
<li class="chapter" data-level="37.8.5" data-path="creating-tables-with-r-and-microsoft-word.html"><a href="creating-tables-with-r-and-microsoft-word.html#significant-digits"><i class="fa fa-check"></i><b>37.8.5</b> Significant digits</a></li>
<li class="chapter" data-level="37.8.6" data-path="creating-tables-with-r-and-microsoft-word.html"><a href="creating-tables-with-r-and-microsoft-word.html#formatting-data-values"><i class="fa fa-check"></i><b>37.8.6</b> Formatting data values</a></li>
</ul></li>
<li class="chapter" data-level="37.9" data-path="creating-tables-with-r-and-microsoft-word.html"><a href="creating-tables-with-r-and-microsoft-word.html#fill-in-title"><i class="fa fa-check"></i><b>37.9</b> Fill in title</a></li>
<li class="chapter" data-level="37.10" data-path="creating-tables-with-r-and-microsoft-word.html"><a href="creating-tables-with-r-and-microsoft-word.html#fill-in-footnotes"><i class="fa fa-check"></i><b>37.10</b> Fill in footnotes</a>
<ul>
<li class="chapter" data-level="37.10.1" data-path="creating-tables-with-r-and-microsoft-word.html"><a href="creating-tables-with-r-and-microsoft-word.html#formatting-footnotes"><i class="fa fa-check"></i><b>37.10.1</b> Formatting footnotes</a></li>
</ul></li>
<li class="chapter" data-level="37.11" data-path="creating-tables-with-r-and-microsoft-word.html"><a href="creating-tables-with-r-and-microsoft-word.html#final-formatting"><i class="fa fa-check"></i><b>37.11</b> Final formatting</a>
<ul>
<li class="chapter" data-level="37.11.1" data-path="creating-tables-with-r-and-microsoft-word.html"><a href="creating-tables-with-r-and-microsoft-word.html#adjust-column-widths"><i class="fa fa-check"></i><b>37.11.1</b> Adjust column widths</a></li>
<li class="chapter" data-level="37.11.2" data-path="creating-tables-with-r-and-microsoft-word.html"><a href="creating-tables-with-r-and-microsoft-word.html#merge-cells"><i class="fa fa-check"></i><b>37.11.2</b> Merge cells</a></li>
<li class="chapter" data-level="37.11.3" data-path="creating-tables-with-r-and-microsoft-word.html"><a href="creating-tables-with-r-and-microsoft-word.html#remove-cell-borders"><i class="fa fa-check"></i><b>37.11.3</b> Remove cell borders</a></li>
</ul></li>
<li class="chapter" data-level="37.12" data-path="creating-tables-with-r-and-microsoft-word.html"><a href="creating-tables-with-r-and-microsoft-word.html#summary-1"><i class="fa fa-check"></i><b>37.12</b> Summary</a></li>
</ul></li>
<li class="part"><span><b>VIII Appendix</b></span></li>
<li class="chapter" data-level="" data-path="appendix-a-glossary.html"><a href="appendix-a-glossary.html"><i class="fa fa-check"></i>Appendix A: Glossary</a></li>
<li class="chapter" data-level="" data-path="appendix-alternative-table-formats.html"><a href="appendix-alternative-table-formats.html"><i class="fa fa-check"></i>Appendix: Alternative table formats</a>
<ul>
<li class="chapter" data-level="37.13" data-path="appendix-alternative-table-formats.html"><a href="appendix-alternative-table-formats.html#smaller-data-frame"><i class="fa fa-check"></i><b>37.13</b> Smaller data frame</a>
<ul>
<li class="chapter" data-level="37.13.1" data-path="appendix-alternative-table-formats.html"><a href="appendix-alternative-table-formats.html#default-method-for-printing-the-data-frame-to-the-screen"><i class="fa fa-check"></i><b>37.13.1</b> Default method for printing the data frame to the screen</a></li>
<li class="chapter" data-level="37.13.2" data-path="appendix-alternative-table-formats.html"><a href="appendix-alternative-table-formats.html#using-the-kable-function"><i class="fa fa-check"></i><b>37.13.2</b> Using the kable function</a></li>
<li class="chapter" data-level="37.13.3" data-path="appendix-alternative-table-formats.html"><a href="appendix-alternative-table-formats.html#using-the-datatable-function"><i class="fa fa-check"></i><b>37.13.3</b> Using the datatable function</a></li>
</ul></li>
<li class="chapter" data-level="37.14" data-path="appendix-alternative-table-formats.html"><a href="appendix-alternative-table-formats.html#larger-data-frame"><i class="fa fa-check"></i><b>37.14</b> Larger data frame</a>
<ul>
<li class="chapter" data-level="37.14.1" data-path="appendix-alternative-table-formats.html"><a href="appendix-alternative-table-formats.html#default-method-for-printing-the-data-frame-to-the-screen-1"><i class="fa fa-check"></i><b>37.14.1</b> Default method for printing the data frame to the screen</a></li>
<li class="chapter" data-level="37.14.2" data-path="appendix-alternative-table-formats.html"><a href="appendix-alternative-table-formats.html#using-the-kable-function-1"><i class="fa fa-check"></i><b>37.14.2</b> Using the kable function</a></li>
<li class="chapter" data-level="37.14.3" data-path="appendix-alternative-table-formats.html"><a href="appendix-alternative-table-formats.html#using-the-datatable-function-1"><i class="fa fa-check"></i><b>37.14.3</b> Using the datatable function</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R for Epidemiology</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="restructuring-data-frames" class="section level1" number="31">
<h1><span class="header-section-number">31</span> Restructuring data frames</h1>
<!--
Use elapsed time as an example of long to wide?
-->
<p>We’ve already seen data frames with a couple of different structures, but we haven’t explicitly discussed those structures yet. When I say structure, I basically mean the way the data is organized into columns and rows. Traditionally, data are described as being organized in one of two ways:</p>
<ol style="list-style-type: decimal">
<li>With a <strong>person-level</strong>, or <strong>wide</strong>, structure. In person-level data, each person (observational unit) has one observation (row) and a separate column contains data for each measurement. For example:</li>
</ol>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-663"></span>
<img src="img/05_part_data_management/10_restructuring/wide1.png" alt="Baby weights at 3, 6, 9 , and 12 months." width="900" />
<p class="caption">
Figure 31.1: Baby weights at 3, 6, 9 , and 12 months.
</p>
</div>
<ol start="2" style="list-style-type: decimal">
<li>With a <strong>person-period</strong>, or <strong>long</strong>, structure. In the person-period data structure each person (observational unit) has multiple observations – one for each measurement occasion.</li>
</ol>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-664"></span>
<img src="img/05_part_data_management/10_restructuring/long1.png" alt="Baby weights at 3, 6, 9 , and 12 months. Babies 1001 and 1002 only." width="900" />
<p class="caption">
Figure 31.2: Baby weights at 3, 6, 9 , and 12 months. Babies 1001 and 1002 only.
</p>
</div>
<p class="note">
🗒<strong>Side Note:</strong> Often, people are our observational unit in epidemiology. However, our observational units could also be schools, states, or air quality monitors. It’s the entity from which we are gathering data.
</p>
<p>In some cases, only the person-level data structure will practically make sense. For example, the table below contains the sex, weight, length, head circumference, and abdominal circumference for eight newborn babies measured cross-sectionally (i.e., at one point in time) at birth.</p>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-665"></span>
<img src="img/05_part_data_management/10_restructuring/wide2.png" alt="Various measurements take at birth for 8 newborn babies." width="900" />
<p class="caption">
Figure 31.3: Various measurements take at birth for 8 newborn babies.
</p>
</div>
<p>In this table, each baby has one observation (row) and a separate column contains data for each measurement. Further, each measurement is only taken on <em>one</em> occasion. There really is no other structure that makes sense for this data.</p>
<p>For contrast, the next table below is also person-level data. It contains the weight in pounds for eight babies at ages 3 months, 6 months, 9 months, and 12 months.</p>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-666"></span>
<img src="img/05_part_data_management/10_restructuring/wide1.png" alt="Baby weights at 3, 6, 9 , and 12 months" width="900" />
<p class="caption">
Figure 31.4: Baby weights at 3, 6, 9 , and 12 months
</p>
</div>
<p>Notice that each baby still has one, and only one, row. This time, however, there are only 2 measurements – sex and weight. Sex is measured on one occasion, but weight is measured on four occasions, and a <em>new column</em> is created in the data frame for each subsequent measure of weight. So, although each baby has a single <em>row</em> in the data, they really have four <em>observations</em> (i.e., measurement occasions). <strong>Notice that this is the first time that we’ve explicitly drawn a distinction between a row and an observation.</strong> Further, unlike the first table we saw, this table could actually be structured in a different way.</p>
<p>An alternative, and often preferable, data structure for data with repeated measures is the person-period, or long, data structure. Below, we look at the baby weights again. In the interest of saving space, we’re only looking at the first two babies from the previous table of data.</p>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-667"></span>
<img src="img/05_part_data_management/10_restructuring/long2.png" alt="Baby weights at 3, 6, 9 , and 12 months. Babies 1001 and 1002 only." width="900" />
<p class="caption">
Figure 31.5: Baby weights at 3, 6, 9 , and 12 months. Babies 1001 and 1002 only.
</p>
</div>
<p>Notice that each baby in the person-period table has four rows – one for each weight measurement. Also notice that there is a new variable in the person-period data that explicitly records time (i.e., <code>months</code>).</p>
<p class="note">
🗒<strong>Side Note:</strong> Let’s quickly learn a couple of new terms: <em>time-varying</em> and <em>time-invariant</em> variables. In the data above, <code>sex</code> is time invariant. It remains constant over all 4 measurement occasions for each baby. Not only that, but for all intents and purposes it isn’t really <em>allowed</em> to change. The <code>weight</code> variable, on the other hand, is time varying. The weight values change over time. And not only do they change, but the amount, rate, and/or shape of their change may be precisely what this researcher is interested in.
</p>
<p>Below, we can compare the person-level version of the baby weight data to the person-period version of the baby weight data. I’m only including babies 1001 and 1002 in the interest of saving space. As you can see, given the same data, the person-level structure is wider (i.e., more <em>columns</em>) than the person-period data and the person-period structure is longer (i.e., more <em>rows</em>) than the person-level data. That’s why the two structures are sometimes referred to as wide and long respectively.</p>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-668"></span>
<img src="img/05_part_data_management/10_restructuring/wide_and_long.png" alt="Comparing wide and long data for the babies 1001 and 1002." width="900" />
<p class="caption">
Figure 31.6: Comparing wide and long data for the babies 1001 and 1002.
</p>
</div>
<p>Ok, so this data <em>can</em> be structured in either a person-level <em>or</em> a person-period format, but which structure <em>should</em> we use?</p>
<p>Well, in general, I’m going to suggest that you use the person-period structure for the kind of longitudinal data we have above for the following reasons:</p>
<ol style="list-style-type: decimal">
<li><p>It contains an explicit time variable. The time information may be descriptively interesting on its own, or we may need to include it in our statistical models. In fact, many longitudinal analyses will require that our data have a person-period structure. For example, mixed models, gereralized estimating equations, and survival analysis.</p></li>
<li><p>The person-period structure can be more efficient when we the intervals between repeated measures vary across observational units. For example, in the data above the baby weight columns were named <code>weight_3</code>, <code>weight_6</code>, <code>weight_9</code>, and <code>weight_12</code>, which indicated each baby’s weight at a 3-month, 6-month, 9-month, and 12-month checkup. However, what if the study needed a more precise measure of each baby’s age. Let’s say that we needed to record each baby’s weight at their precise age in days at each checkup. That might look something like the following if structured in a person-level format:</p></li>
</ol>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-669"></span>
<img src="img/05_part_data_management/10_restructuring/days_wide.png" alt="Baby weights at age in days. Babies 1001 and 1002 only." width="900" />
<p class="caption">
Figure 31.7: Baby weights at age in days. Babies 1001 and 1002 only.
</p>
</div>
<p>Notice all the missing data in this format – even with only two babies. For example, baby 1001 had her first check-up at 36 days old. She was 9 lbs. Baby 1002, however, didn’t have her first checkup until she was 84 days old. So, baby 1002 has a missing value for <code>weight_36</code>. That pattern continues throughout the data. Now, just try to imagine what this would look like for tens, hundreds, or thousands of babies. It would be a mess! By contrast, the person-period version of this data is much more efficient. In fact, it looks almost identical to the first person-period version of this data:</p>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-670"></span>
<img src="img/05_part_data_management/10_restructuring/days_long.png" alt="Baby weights at age in days. Babies 1001 and 1002 only." width="900" />
<p class="caption">
Figure 31.8: Baby weights at age in days. Babies 1001 and 1002 only.
</p>
</div>
<ol start="3" style="list-style-type: decimal">
<li><p>For essentially the same reasons already discussed above, the person-period format is better suited for handling time-varying predictors. In the baby weight data, the only predictor variable (other than time) was sex, which is time invariant. Regardless of which structure we us, sex only requires one column in the data frame because it never changes. However, imagine scenario were we also collect height and information about diet at each visit. Using a person-level structure to store these variables would have the same limitations that we already discussed above (i.e., no explicit measure of time, incompatibility with many analysis techniques, and potentially inefficient storage).</p></li>
<li><p>Many of the “tidyverse” packages we use in this book (e.g., <code>dplyr</code> and <code>ggplot2</code>) assume, or at least work best, with data organized in a person-period, or long, format.</p></li>
</ol>
<p>So, does this mean that we should <em>never</em> organize our data frames in a person-level format? Of course not! There are going to be some occasions when there are advantages to organizing our data frames in a person-level format. For example:</p>
<ol style="list-style-type: decimal">
<li><p>Many people prefer the person-level format during the data entry process because it can require less typing. Thinking about our baby weight data above, we would only need to type one new value at each checkup (i.e., weight) if the data is organized in a person-level format. However, if the data is organized in a person-period format, we have to type three new values (i.e., id, sex, and weight). This limitation grows with the number of time-invariant variables in the data.</p></li>
<li><p>There are some analyses that will require that our data have a person-level structure. For example, the traditional ANOVA and MANOVA techniques assume the wide format.</p></li>
<li><p>There are times when our data is easier to manipulate when it is organized in a person-level format.</p></li>
<li><p>There are times when it’s advantageous to restructure statistical results from a longer format to a wider format to present them in the most effective way possible.</p></li>
</ol>
<p>Luckily, we rarely have to choose one structure or the other in an absolute sense. The <code>tidyr</code> package generally makes it very easy for us to restructure (“reshape” is another commonly used term) our data frames from wide to long and back again. This allows us to organize our data in the manner that is best suited for the particular task at hand. Let’s go ahead and take a look at some examples.</p>
<div id="the-tidyr-package" class="section level2" number="31.1">
<h2><span class="header-section-number">31.1</span> The tidyr package</h2>
<p>The tools we will use for restructuring our data will primarily come from a package we haven’t used before in this book – <code>tidyr</code>. If you haven’t already done so, and you’d like to follow along, please install and load <code>tidyr</code>, <code>dplyr</code>, and <code>ggplot2</code> now.</p>
<div class="sourceCode" id="cb900"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb900-1"><a href="restructuring-data-frames.html#cb900-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb900-2"><a href="restructuring-data-frames.html#cb900-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb900-3"><a href="restructuring-data-frames.html#cb900-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code></pre></div>
</div>
<div id="pivoting-longer" class="section level2" number="31.2">
<h2><span class="header-section-number">31.2</span> Pivoting longer</h2>
<p>In epidemiology, it’s common for data that we analyze to be measured on multiple occasions. It’s also common for repeated measures data to be entered into a spreadsheet or database in such a way that each new measure is a new column. We saw an example of this above:</p>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-672"></span>
<img src="img/05_part_data_management/10_restructuring/wide1.png" alt="Baby weights at 3, 6, 9 , and 12 months" width="900" />
<p class="caption">
Figure 31.9: Baby weights at 3, 6, 9 , and 12 months
</p>
</div>
<p>We already concluded that this data has a person-level (wide) structure. As discussed above, many techniques that we may want to use to analyze this data will require us to restructure it to a person-period format. Let’s go ahead and walk through a demonstration of how do that. We will start by simulating this data in R:</p>
<div class="sourceCode" id="cb901"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb901-1"><a href="restructuring-data-frames.html#cb901-1" aria-hidden="true" tabindex="-1"></a>babies <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb901-2"><a href="restructuring-data-frames.html#cb901-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">id       =</span> <span class="dv">1001</span><span class="sc">:</span><span class="dv">1008</span>,</span>
<span id="cb901-3"><a href="restructuring-data-frames.html#cb901-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">sex      =</span> <span class="fu">c</span>(<span class="st">&quot;F&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;F&quot;</span>),</span>
<span id="cb901-4"><a href="restructuring-data-frames.html#cb901-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_3  =</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">11</span>, <span class="dv">17</span>, <span class="dv">16</span>, <span class="dv">11</span>, <span class="dv">17</span>, <span class="dv">16</span>, <span class="dv">15</span>),</span>
<span id="cb901-5"><a href="restructuring-data-frames.html#cb901-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_6  =</span> <span class="fu">c</span>(<span class="dv">13</span>, <span class="dv">16</span>, <span class="dv">20</span>, <span class="dv">18</span>, <span class="dv">15</span>, <span class="dv">21</span>, <span class="dv">17</span>, <span class="dv">16</span>),</span>
<span id="cb901-6"><a href="restructuring-data-frames.html#cb901-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_9  =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">23</span>, <span class="dv">21</span>, <span class="dv">16</span>, <span class="dv">25</span>, <span class="dv">19</span>, <span class="dv">18</span>),</span>
<span id="cb901-7"><a href="restructuring-data-frames.html#cb901-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_12 =</span> <span class="fu">c</span>(<span class="dv">17</span>, <span class="dv">20</span>, <span class="dv">24</span>, <span class="dv">22</span>, <span class="dv">18</span>, <span class="dv">26</span>, <span class="dv">21</span>, <span class="dv">19</span>)</span>
<span id="cb901-8"><a href="restructuring-data-frames.html#cb901-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb901-9"><a href="restructuring-data-frames.html#cb901-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code></pre></div>
<pre><code>## # A tibble: 8 × 6
##      id sex   weight_3 weight_6 weight_9 weight_12
##   &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1  1001 F            9       13       16        17
## 2  1002 F           11       16       17        20
## 3  1003 M           17       20       23        24
## 4  1004 F           16       18       21        22
## 5  1005 M           11       15       16        18
## 6  1006 M           17       21       25        26
## 7  1007 M           16       17       19        21
## 8  1008 F           15       16       18        19</code></pre>
<p>Now, let’s use the <code>pivot_longer()</code> function to restructure the <code>babies</code> data frame to a person-period format:</p>
<div class="sourceCode" id="cb903"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb903-1"><a href="restructuring-data-frames.html#cb903-1" aria-hidden="true" tabindex="-1"></a>babies_long <span class="ot">&lt;-</span> babies <span class="sc">%&gt;%</span> </span>
<span id="cb903-2"><a href="restructuring-data-frames.html#cb903-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb903-3"><a href="restructuring-data-frames.html#cb903-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols         =</span> <span class="fu">starts_with</span>(<span class="st">&quot;weight&quot;</span>),</span>
<span id="cb903-4"><a href="restructuring-data-frames.html#cb903-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to     =</span> <span class="st">&quot;months&quot;</span>,</span>
<span id="cb903-5"><a href="restructuring-data-frames.html#cb903-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">&quot;weight_&quot;</span>,</span>
<span id="cb903-6"><a href="restructuring-data-frames.html#cb903-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to    =</span> <span class="st">&quot;weight&quot;</span></span>
<span id="cb903-7"><a href="restructuring-data-frames.html#cb903-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb903-8"><a href="restructuring-data-frames.html#cb903-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code></pre></div>
<pre><code>## # A tibble: 32 × 4
##       id sex   months weight
##    &lt;int&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;
##  1  1001 F     3           9
##  2  1001 F     6          13
##  3  1001 F     9          16
##  4  1001 F     12         17
##  5  1002 F     3          11
##  6  1002 F     6          16
##  7  1002 F     9          17
##  8  1002 F     12         20
##  9  1003 M     3          17
## 10  1003 M     6          20
## # … with 22 more rows</code></pre>
<p>👆<strong>Here’s what we did above:</strong></p>
<ul>
<li><p>We used <code>tidyr</code>’s <code>pivot_longer()</code> function to restructure the <code>babies</code> data frame from person-level (wide) to person-period (long).</p></li>
<li><p>You can type <code>?pivot_longer</code> into your R console to view the help documentation for this function and follow along with the explanation below.</p></li>
<li><p>The first argument to the <code>pivot_longer()</code> function is the <code>data</code> argument. You should pass the name of the data frame you want to restructure to the <code>data</code> argument. Above, we passed the <code>babies</code> data frame to the <code>data</code> argument using a pipe operator.</p></li>
<li><p>The second argument to the <code>pivot_longer()</code> function is the <code>cols</code> argument. You should pass the name of the columns you want to make longer to the <code>cols</code> argument. Above, we passed the names of the four weight columns to the <code>cols</code> argument. The <code>cols</code> argument actually accepts tidy-select argument modifiers. We first discussed tidy-select argument modifiers in the <a href="the-select-function">chapter on subsetting data frames</a>. In the example above, we used the <code>starts_with()</code> tidy-select modifier to simplify our code. Instead of passing each column name directly to the <code>cols</code> argument, we asked <code>starts_with()</code> to pass the name of any column that has a column name that starts with the word “weight” to the <code>cols</code> argument.</p></li>
<li><p>The third argument to the <code>pivot_longer()</code> function is the <code>names_to</code> argument. You should pass the <code>names_to</code> argument a character string or character vector that tells <code>pivot_longer()</code> what you want to name the column that will contain the previous column names that were pivoted. By default, the value passed to the <code>names_to</code> argument is <code>"name"</code>. We passed the value <code>"months"</code> to the <code>names_to</code> argument. This tells <code>pivot_longer()</code> what to name the column that contains the names of the previous column names. If that seems really confusing, I’m with you. Unfortunately, I don’t currently know a better way to write it, but I will <em>show</em> you what the <code>names_to</code> argument does below.</p></li>
<li><p>The fourth argument to the <code>pivot_longer()</code> function is the <code>names_prefix</code> argument. You should pass the <code>names_prefix</code> argument a regular expression that tells <code>pivot_longer()</code> what to remove from the start of each of the previous column names that we pivoted. By default, the value passed to the <code>names_prefix</code> argument is <code>NULL</code> (i.e., it doesn’t remove anything). We passed the value <code>"weight_"</code> to the <code>names_prefix</code> argument. This tells <code>pivot_longer()</code> that we want to remove the character string “weight_” from the start of each of the previous column names that we pivoted. For example, removing “weight_” from “weight_3” results in the value “3,” removing “weight_” from “weight_6” results in the value “6,” and so on. Again, I will show you what the <code>names_prefix</code> argument does below.</p></li>
<li><p>The eighth argument (we left the 5th, 6th, and 7th arguments at their default values) to the <code>pivot_longer()</code> function is the <code>values_to</code> argument. You should pass the <code>values_to</code> argument a character string or character vector that tells <code>pivot_longer()</code> what you want to name the column that will contain the values from the columns that were pivoted. By default, the value passed to the <code>values_to</code> argument is <code>"value"</code>. We passed the value <code>"weight"</code> to the <code>values_to</code> argument. This tells <code>pivot_longer()</code> what to name the column that contains values from the columns that were pivoted. I will demonstrate what the <code>values_to</code> argument does below as well.</p></li>
</ul>
<div id="the-names_to-argument" class="section level3" number="31.2.1">
<h3><span class="header-section-number">31.2.1</span> The names_to argument</h3>
<p>The official help documentation for <code>pivot_longer()</code> says that the value passed to the <code>names_to</code> argument should be “a string specifying the name of the column to create from the data stored in the column names of data.” I don’t blame you if you feel like that’s a little bit difficult to wrap your head around. Let’s take a look at the result we get when we don’t adjust the value passed to the <code>names_to</code> argument:</p>
<div class="sourceCode" id="cb905"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb905-1"><a href="restructuring-data-frames.html#cb905-1" aria-hidden="true" tabindex="-1"></a>babies <span class="sc">%&gt;%</span> </span>
<span id="cb905-2"><a href="restructuring-data-frames.html#cb905-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb905-3"><a href="restructuring-data-frames.html#cb905-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;weight&quot;</span>)</span>
<span id="cb905-4"><a href="restructuring-data-frames.html#cb905-4" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 32 × 4
##       id sex   name      value
##    &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;dbl&gt;
##  1  1001 F     weight_3      9
##  2  1001 F     weight_6     13
##  3  1001 F     weight_9     16
##  4  1001 F     weight_12    17
##  5  1002 F     weight_3     11
##  6  1002 F     weight_6     16
##  7  1002 F     weight_9     17
##  8  1002 F     weight_12    20
##  9  1003 M     weight_3     17
## 10  1003 M     weight_6     20
## # … with 22 more rows</code></pre>
<p><img src="img/05_part_data_management/10_restructuring/names_to.png" width="900" /></p>
<p>As you can see, when we only pass a value to the <code>cols</code> argument, <code>pivot_longer()</code> creates a new column that contains the column names from the data frame passed to the <code>data</code> argument, that are being pivoted into long format. By default, <code>pivot_longer()</code> names that column <code>name</code>. However, that name isn’t very informative. We will go ahead and change the column name to “months” because we know that this column will eventually contain month values. We do so by passing the value <code>"months"</code> to the <code>names_to</code> argument like this:</p>
<div class="sourceCode" id="cb907"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb907-1"><a href="restructuring-data-frames.html#cb907-1" aria-hidden="true" tabindex="-1"></a>babies <span class="sc">%&gt;%</span> </span>
<span id="cb907-2"><a href="restructuring-data-frames.html#cb907-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb907-3"><a href="restructuring-data-frames.html#cb907-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols     =</span> <span class="fu">starts_with</span>(<span class="st">&quot;weight&quot;</span>),</span>
<span id="cb907-4"><a href="restructuring-data-frames.html#cb907-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;months&quot;</span></span>
<span id="cb907-5"><a href="restructuring-data-frames.html#cb907-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 32 × 4
##       id sex   months    value
##    &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;dbl&gt;
##  1  1001 F     weight_3      9
##  2  1001 F     weight_6     13
##  3  1001 F     weight_9     16
##  4  1001 F     weight_12    17
##  5  1002 F     weight_3     11
##  6  1002 F     weight_6     16
##  7  1002 F     weight_9     17
##  8  1002 F     weight_12    20
##  9  1003 M     weight_3     17
## 10  1003 M     weight_6     20
## # … with 22 more rows</code></pre>
</div>
<div id="the-names_prefix-argument" class="section level3" number="31.2.2">
<h3><span class="header-section-number">31.2.2</span> The names_prefix argument</h3>
<p>The official help documentation for <code>pivot_longer()</code> says that the value passed to the <code>names_prefix</code> argument should be “a regular expression used to remove matching text from the start of each variable name.” Passing a value to this argument can be really useful when column names actually contain data values, which was the case above. Take the column name “weight_3” for example. The “weight” part is truly a column name – it tells us what the values in that column are. They are weights. The “3” part is actually a separate data value meaning “3 months.” If we can remove the “weight_” part of the column name, then what remains is a useful column of information – time measured in months. Passing the value “weight_” to the <code>names_prefix</code> argument does exactly that.</p>
<div class="sourceCode" id="cb909"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb909-1"><a href="restructuring-data-frames.html#cb909-1" aria-hidden="true" tabindex="-1"></a>babies <span class="sc">%&gt;%</span> </span>
<span id="cb909-2"><a href="restructuring-data-frames.html#cb909-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb909-3"><a href="restructuring-data-frames.html#cb909-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols         =</span> <span class="fu">starts_with</span>(<span class="st">&quot;weight&quot;</span>),</span>
<span id="cb909-4"><a href="restructuring-data-frames.html#cb909-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to     =</span> <span class="st">&quot;months&quot;</span>,</span>
<span id="cb909-5"><a href="restructuring-data-frames.html#cb909-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">&quot;weight_&quot;</span></span>
<span id="cb909-6"><a href="restructuring-data-frames.html#cb909-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 32 × 4
##       id sex   months value
##    &lt;int&gt; &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;
##  1  1001 F     3          9
##  2  1001 F     6         13
##  3  1001 F     9         16
##  4  1001 F     12        17
##  5  1002 F     3         11
##  6  1002 F     6         16
##  7  1002 F     9         17
##  8  1002 F     12        20
##  9  1003 M     3         17
## 10  1003 M     6         20
## # … with 22 more rows</code></pre>
<p>Now, the value passed to the <code>names_prefix</code> argument can be any regular expression. So, we could have written a more complicated, and flexible, regular expression like this:</p>
<div class="sourceCode" id="cb911"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb911-1"><a href="restructuring-data-frames.html#cb911-1" aria-hidden="true" tabindex="-1"></a>babies <span class="sc">%&gt;%</span> </span>
<span id="cb911-2"><a href="restructuring-data-frames.html#cb911-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb911-3"><a href="restructuring-data-frames.html#cb911-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols         =</span> <span class="fu">starts_with</span>(<span class="st">&quot;weight&quot;</span>),</span>
<span id="cb911-4"><a href="restructuring-data-frames.html#cb911-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to     =</span> <span class="st">&quot;months&quot;</span>,</span>
<span id="cb911-5"><a href="restructuring-data-frames.html#cb911-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">w+_&quot;</span></span>
<span id="cb911-6"><a href="restructuring-data-frames.html#cb911-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 32 × 4
##       id sex   months value
##    &lt;int&gt; &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;
##  1  1001 F     3          9
##  2  1001 F     6         13
##  3  1001 F     9         16
##  4  1001 F     12        17
##  5  1002 F     3         11
##  6  1002 F     6         16
##  7  1002 F     9         17
##  8  1002 F     12        20
##  9  1003 M     3         17
## 10  1003 M     6         20
## # … with 22 more rows</code></pre>
<p>The regular expression above would have removed <em>any</em> word characters followed by an underscore. However, in this case, the value <code>"weight_"</code> is straightforward and gets the job done.</p>
</div>
<div id="the-values_to-argument" class="section level3" number="31.2.3">
<h3><span class="header-section-number">31.2.3</span> The values_to argument</h3>
<p>The official help documentation for <code>pivot_longer()</code> says that the value passed to the <code>values_to</code> argument should be “a string specifying the name of the column to create from the data stored in cell values.” All that means is that we use this argument to name the column that contains the values that were pivoted.</p>
<p><img src="img/05_part_data_management/10_restructuring/values_to.png" width="900" /></p>
<p>By default, <code>pivot_longer()</code> names that column “value.” However, we will once again want a more informative column name in our new data frame. So, we’ll go ahead and change the column name to “weight” because that’s what the values in that column are – weights. We do so by passing the value <code>"weight"</code> to the <code>values_to</code> argument like this:</p>
<div class="sourceCode" id="cb913"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb913-1"><a href="restructuring-data-frames.html#cb913-1" aria-hidden="true" tabindex="-1"></a>babies <span class="sc">%&gt;%</span> </span>
<span id="cb913-2"><a href="restructuring-data-frames.html#cb913-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb913-3"><a href="restructuring-data-frames.html#cb913-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols         =</span> <span class="fu">starts_with</span>(<span class="st">&quot;weight&quot;</span>),</span>
<span id="cb913-4"><a href="restructuring-data-frames.html#cb913-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to     =</span> <span class="st">&quot;months&quot;</span>,</span>
<span id="cb913-5"><a href="restructuring-data-frames.html#cb913-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">&quot;weight_&quot;</span>,</span>
<span id="cb913-6"><a href="restructuring-data-frames.html#cb913-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to    =</span> <span class="st">&quot;weight&quot;</span></span>
<span id="cb913-7"><a href="restructuring-data-frames.html#cb913-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 32 × 4
##       id sex   months weight
##    &lt;int&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;
##  1  1001 F     3           9
##  2  1001 F     6          13
##  3  1001 F     9          16
##  4  1001 F     12         17
##  5  1002 F     3          11
##  6  1002 F     6          16
##  7  1002 F     9          17
##  8  1002 F     12         20
##  9  1003 M     3          17
## 10  1003 M     6          20
## # … with 22 more rows</code></pre>
</div>
<div id="the-names_transform-argument" class="section level3" number="31.2.4">
<h3><span class="header-section-number">31.2.4</span> The names_transform argument</h3>
<p>As one little final touch on the data restructuring at hand, it would be nice to coerce the <code>months</code> column from type character to type integer. We already know how to do this with <code>mutate()</code>:</p>
<div class="sourceCode" id="cb915"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb915-1"><a href="restructuring-data-frames.html#cb915-1" aria-hidden="true" tabindex="-1"></a>babies <span class="sc">%&gt;%</span> </span>
<span id="cb915-2"><a href="restructuring-data-frames.html#cb915-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb915-3"><a href="restructuring-data-frames.html#cb915-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols         =</span> <span class="fu">starts_with</span>(<span class="st">&quot;weight&quot;</span>),</span>
<span id="cb915-4"><a href="restructuring-data-frames.html#cb915-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to     =</span> <span class="st">&quot;months&quot;</span>,</span>
<span id="cb915-5"><a href="restructuring-data-frames.html#cb915-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">&quot;weight_&quot;</span>,</span>
<span id="cb915-6"><a href="restructuring-data-frames.html#cb915-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to    =</span> <span class="st">&quot;weight&quot;</span></span>
<span id="cb915-7"><a href="restructuring-data-frames.html#cb915-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb915-8"><a href="restructuring-data-frames.html#cb915-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">months =</span> <span class="fu">as.integer</span>(months))</span></code></pre></div>
<pre><code>## # A tibble: 32 × 4
##       id sex   months weight
##    &lt;int&gt; &lt;chr&gt;  &lt;int&gt;  &lt;dbl&gt;
##  1  1001 F          3      9
##  2  1001 F          6     13
##  3  1001 F          9     16
##  4  1001 F         12     17
##  5  1002 F          3     11
##  6  1002 F          6     16
##  7  1002 F          9     17
##  8  1002 F         12     20
##  9  1003 M          3     17
## 10  1003 M          6     20
## # … with 22 more rows</code></pre>
<p>However, we can also do this directly inside the <code>pivot_longer()</code> function by passing a list of column names paired with type coercion functions. For example:</p>
<div class="sourceCode" id="cb917"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb917-1"><a href="restructuring-data-frames.html#cb917-1" aria-hidden="true" tabindex="-1"></a>babies <span class="sc">%&gt;%</span> </span>
<span id="cb917-2"><a href="restructuring-data-frames.html#cb917-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb917-3"><a href="restructuring-data-frames.html#cb917-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols            =</span> <span class="fu">starts_with</span>(<span class="st">&quot;weight&quot;</span>),</span>
<span id="cb917-4"><a href="restructuring-data-frames.html#cb917-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to        =</span> <span class="st">&quot;months&quot;</span>,</span>
<span id="cb917-5"><a href="restructuring-data-frames.html#cb917-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix    =</span> <span class="st">&quot;weight_&quot;</span>,</span>
<span id="cb917-6"><a href="restructuring-data-frames.html#cb917-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_transform =</span> <span class="fu">list</span>(<span class="at">months =</span> as.integer),</span>
<span id="cb917-7"><a href="restructuring-data-frames.html#cb917-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to       =</span> <span class="st">&quot;weight&quot;</span></span>
<span id="cb917-8"><a href="restructuring-data-frames.html#cb917-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 32 × 4
##       id sex   months weight
##    &lt;int&gt; &lt;chr&gt;  &lt;int&gt;  &lt;dbl&gt;
##  1  1001 F          3      9
##  2  1001 F          6     13
##  3  1001 F          9     16
##  4  1001 F         12     17
##  5  1002 F          3     11
##  6  1002 F          6     16
##  7  1002 F          9     17
##  8  1002 F         12     20
##  9  1003 M          3     17
## 10  1003 M          6     20
## # … with 22 more rows</code></pre>
<p>👆<strong>Here’s what we did above:</strong></p>
<ul>
<li>We coerced the <code>months</code> column from type character to type integer by passing the value <code>list(months = as.integer)</code> to the <code>names_transform</code> argument. The list passed to <code>names_transform</code> should contain one or more column names paired with a type coercion function. The column name and type coercion function should be paired using an equal sign. Multiple pairs should be separated by commas.</li>
</ul>
</div>
<div id="pivoting-multiple-sets-of-columns" class="section level3" number="31.2.5">
<h3><span class="header-section-number">31.2.5</span> Pivoting multiple sets of columns</h3>
<p>Let’s add a little layer of complexity to our situation. Let’s say that our <code>babies</code> data frame also includes each baby’s length in inches measured at each visit:</p>
<div class="sourceCode" id="cb919"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb919-1"><a href="restructuring-data-frames.html#cb919-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb919-2"><a href="restructuring-data-frames.html#cb919-2" aria-hidden="true" tabindex="-1"></a>babies <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb919-3"><a href="restructuring-data-frames.html#cb919-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">id       =</span> <span class="dv">1001</span><span class="sc">:</span><span class="dv">1008</span>,</span>
<span id="cb919-4"><a href="restructuring-data-frames.html#cb919-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sex      =</span> <span class="fu">c</span>(<span class="st">&quot;F&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;F&quot;</span>),</span>
<span id="cb919-5"><a href="restructuring-data-frames.html#cb919-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_3  =</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">11</span>, <span class="dv">17</span>, <span class="dv">16</span>, <span class="dv">11</span>, <span class="dv">17</span>, <span class="dv">16</span>, <span class="dv">15</span>),</span>
<span id="cb919-6"><a href="restructuring-data-frames.html#cb919-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_6  =</span> <span class="fu">c</span>(<span class="dv">13</span>, <span class="dv">16</span>, <span class="dv">20</span>, <span class="dv">18</span>, <span class="dv">15</span>, <span class="dv">21</span>, <span class="dv">17</span>, <span class="dv">16</span>),</span>
<span id="cb919-7"><a href="restructuring-data-frames.html#cb919-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_9  =</span> <span class="fu">c</span>(<span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">23</span>, <span class="dv">21</span>, <span class="dv">16</span>, <span class="dv">25</span>, <span class="dv">19</span>, <span class="dv">18</span>),</span>
<span id="cb919-8"><a href="restructuring-data-frames.html#cb919-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">weight_12 =</span> <span class="fu">c</span>(<span class="dv">17</span>, <span class="dv">20</span>, <span class="dv">24</span>, <span class="dv">22</span>, <span class="dv">18</span>, <span class="dv">26</span>, <span class="dv">21</span>, <span class="dv">19</span>),</span>
<span id="cb919-9"><a href="restructuring-data-frames.html#cb919-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">length_3  =</span> <span class="fu">c</span>(<span class="dv">17</span>, <span class="dv">19</span>, <span class="dv">23</span>, <span class="dv">20</span>, <span class="dv">18</span>, <span class="dv">22</span>, <span class="dv">21</span>, <span class="dv">18</span>),</span>
<span id="cb919-10"><a href="restructuring-data-frames.html#cb919-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">length_6  =</span> <span class="fu">round</span>(length_3 <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">8</span>, <span class="dv">2</span>, <span class="dv">1</span>)),</span>
<span id="cb919-11"><a href="restructuring-data-frames.html#cb919-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">length_9  =</span> <span class="fu">round</span>(length_6 <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">8</span>, <span class="dv">2</span>, <span class="dv">1</span>)),</span>
<span id="cb919-12"><a href="restructuring-data-frames.html#cb919-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">length_12 =</span> <span class="fu">round</span>(length_9 <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">8</span>, <span class="dv">2</span>, <span class="dv">1</span>)),</span>
<span id="cb919-13"><a href="restructuring-data-frames.html#cb919-13" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb919-14"><a href="restructuring-data-frames.html#cb919-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code></pre></div>
<pre><code>## # A tibble: 8 × 10
##      id sex   weight_3 weight_6 weight_9 weight_12 length_3 length_6 length_9 length_12
##   &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1  1001 F            9       13       16        17       17       18       19        21
## 2  1002 F           11       16       17        20       19       21       23        23
## 3  1003 M           17       20       23        24       23       27       30        33
## 4  1004 F           16       18       21        22       20       22       24        26
## 5  1005 M           11       15       16        18       18       20       22        23
## 6  1006 M           17       21       25        26       22       26       28        30
## 7  1007 M           16       17       19        21       21       23       24        25
## 8  1008 F           15       16       18        19       18       19       23        24</code></pre>
<p>Here is what we want our final data frame to look like:</p>
<div class="sourceCode" id="cb921"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb921-1"><a href="restructuring-data-frames.html#cb921-1" aria-hidden="true" tabindex="-1"></a>babies <span class="sc">%&gt;%</span> </span>
<span id="cb921-2"><a href="restructuring-data-frames.html#cb921-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb921-3"><a href="restructuring-data-frames.html#cb921-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols      =</span> <span class="fu">c</span>(<span class="sc">-</span>id, <span class="sc">-</span>sex),</span>
<span id="cb921-4"><a href="restructuring-data-frames.html#cb921-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to  =</span> <span class="fu">c</span>(<span class="st">&quot;.value&quot;</span>, <span class="st">&quot;months&quot;</span>),</span>
<span id="cb921-5"><a href="restructuring-data-frames.html#cb921-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span></span>
<span id="cb921-6"><a href="restructuring-data-frames.html#cb921-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 32 × 5
##       id sex   months weight length
##    &lt;int&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;
##  1  1001 F     3           9     17
##  2  1001 F     6          13     18
##  3  1001 F     9          16     19
##  4  1001 F     12         17     21
##  5  1002 F     3          11     19
##  6  1002 F     6          16     21
##  7  1002 F     9          17     23
##  8  1002 F     12         20     23
##  9  1003 M     3          17     23
## 10  1003 M     6          20     27
## # … with 22 more rows</code></pre>
<p>Next, we’ll walk through getting to this result step-by-step.</p>
<p>We are once again starting with a person-level data frame, and we once again want to restructure it to a person-period data frame. This is the result we get if we use the same code we previously used to restructure the data frame that didn’t include each baby’s length:</p>
<div class="sourceCode" id="cb923"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb923-1"><a href="restructuring-data-frames.html#cb923-1" aria-hidden="true" tabindex="-1"></a>babies_long <span class="ot">&lt;-</span> babies <span class="sc">%&gt;%</span> </span>
<span id="cb923-2"><a href="restructuring-data-frames.html#cb923-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb923-3"><a href="restructuring-data-frames.html#cb923-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols         =</span> <span class="fu">starts_with</span>(<span class="st">&quot;weight&quot;</span>),</span>
<span id="cb923-4"><a href="restructuring-data-frames.html#cb923-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to     =</span> <span class="st">&quot;months&quot;</span>,</span>
<span id="cb923-5"><a href="restructuring-data-frames.html#cb923-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">&quot;weight_&quot;</span>,</span>
<span id="cb923-6"><a href="restructuring-data-frames.html#cb923-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to    =</span> <span class="st">&quot;weight&quot;</span></span>
<span id="cb923-7"><a href="restructuring-data-frames.html#cb923-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb923-8"><a href="restructuring-data-frames.html#cb923-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code></pre></div>
<pre><code>## # A tibble: 32 × 8
##       id sex   length_3 length_6 length_9 length_12 months weight
##    &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;
##  1  1001 F           17       18       19        21 3           9
##  2  1001 F           17       18       19        21 6          13
##  3  1001 F           17       18       19        21 9          16
##  4  1001 F           17       18       19        21 12         17
##  5  1002 F           19       21       23        23 3          11
##  6  1002 F           19       21       23        23 6          16
##  7  1002 F           19       21       23        23 9          17
##  8  1002 F           19       21       23        23 12         20
##  9  1003 M           23       27       30        33 3          17
## 10  1003 M           23       27       30        33 6          20
## # … with 22 more rows</code></pre>
<p>Because we aren’t passing any of the <code>length_</code> columns to the <code>cols</code> argument, <code>pivot_longer()</code> is treating them like the other time-invariant variables (i.e., <code>id</code> and <code>sex</code>). Their values are just being recycled across every row within each id. So, let’s add the <code>length_</code> columns to the <code>cols</code> argument and see what happens:</p>
<div class="sourceCode" id="cb925"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb925-1"><a href="restructuring-data-frames.html#cb925-1" aria-hidden="true" tabindex="-1"></a>babies_long <span class="ot">&lt;-</span> babies <span class="sc">%&gt;%</span> </span>
<span id="cb925-2"><a href="restructuring-data-frames.html#cb925-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb925-3"><a href="restructuring-data-frames.html#cb925-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols         =</span> <span class="fu">c</span>(<span class="sc">-</span>id, <span class="sc">-</span>sex),</span>
<span id="cb925-4"><a href="restructuring-data-frames.html#cb925-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to     =</span> <span class="st">&quot;months&quot;</span>,</span>
<span id="cb925-5"><a href="restructuring-data-frames.html#cb925-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">&quot;weight_&quot;</span>,</span>
<span id="cb925-6"><a href="restructuring-data-frames.html#cb925-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to    =</span> <span class="st">&quot;weight&quot;</span></span>
<span id="cb925-7"><a href="restructuring-data-frames.html#cb925-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb925-8"><a href="restructuring-data-frames.html#cb925-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code></pre></div>
<pre><code>## # A tibble: 64 × 4
##       id sex   months    weight
##    &lt;int&gt; &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;
##  1  1001 F     3              9
##  2  1001 F     6             13
##  3  1001 F     9             16
##  4  1001 F     12            17
##  5  1001 F     length_3      17
##  6  1001 F     length_6      18
##  7  1001 F     length_9      19
##  8  1001 F     length_12     21
##  9  1002 F     3             11
## 10  1002 F     6             16
## # … with 54 more rows</code></pre>
<p>👆<strong>Here’s what we did above:</strong></p>
<ul>
<li>We passed the <code>weight_</code> and <code>length_</code> columns to the <code>cols</code> argument <em>indirectly</em> by passing the value <code>c(-id, -sex)</code>. Basically, this tells <code>pivot_longer()</code> that we would like to pivot every column <em>except</em> <code>id</code> and <code>sex</code>.</li>
</ul>
<p>Now, we are pivoting both the <code>weight_</code> columns and the <code>length_</code> columns. That’s an improvement. However, we obviously still don’t have the result we want.</p>
<p>Remember that the value passed to the <code>names_prefix</code> argument is used to remove matching text from the start of each variable name. Passing the value <code>"weight_"</code> to the <code>names_prefix</code> argument made sense when all of our pivoted columns began with the character sting “weight_.” Now, however, some of our pivoted columns begin with the character string “length_.” That’s why we are still seeing values in the <code>months</code> column like <code>length_3</code>, <code>length_6</code>, and so on.</p>
<p>Now, your first instinct might be to just add <code>"length_"</code> to the <code>names_prefix</code> argument. Unfortunately, that doesn’t work:</p>
<div class="sourceCode" id="cb927"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb927-1"><a href="restructuring-data-frames.html#cb927-1" aria-hidden="true" tabindex="-1"></a>babies_long <span class="ot">&lt;-</span> babies <span class="sc">%&gt;%</span> </span>
<span id="cb927-2"><a href="restructuring-data-frames.html#cb927-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb927-3"><a href="restructuring-data-frames.html#cb927-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols         =</span> <span class="fu">c</span>(<span class="sc">-</span>id, <span class="sc">-</span>sex),</span>
<span id="cb927-4"><a href="restructuring-data-frames.html#cb927-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to     =</span> <span class="st">&quot;months&quot;</span>,</span>
<span id="cb927-5"><a href="restructuring-data-frames.html#cb927-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="fu">c</span>(<span class="st">&quot;weight_&quot;</span>, <span class="st">&quot;length_&quot;</span>),</span>
<span id="cb927-6"><a href="restructuring-data-frames.html#cb927-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to    =</span> <span class="st">&quot;weight&quot;</span></span>
<span id="cb927-7"><a href="restructuring-data-frames.html#cb927-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb927-8"><a href="restructuring-data-frames.html#cb927-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code></pre></div>
<pre><code>## Warning in gsub(paste0(&quot;^&quot;, names_prefix), &quot;&quot;, names(cols)): argument &#39;pattern&#39; has length &gt; 1 and only the first element will be used</code></pre>
<pre><code>## # A tibble: 64 × 4
##       id sex   months    weight
##    &lt;int&gt; &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;
##  1  1001 F     3              9
##  2  1001 F     6             13
##  3  1001 F     9             16
##  4  1001 F     12            17
##  5  1001 F     length_3      17
##  6  1001 F     length_6      18
##  7  1001 F     length_9      19
##  8  1001 F     length_12     21
##  9  1002 F     3             11
## 10  1002 F     6             16
## # … with 54 more rows</code></pre>
<p>Instead, we need to drop the <code>names_prefix</code> argument altogether before we can move forward to the correct solution:</p>
<div class="sourceCode" id="cb930"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb930-1"><a href="restructuring-data-frames.html#cb930-1" aria-hidden="true" tabindex="-1"></a>babies_long <span class="ot">&lt;-</span> babies <span class="sc">%&gt;%</span> </span>
<span id="cb930-2"><a href="restructuring-data-frames.html#cb930-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb930-3"><a href="restructuring-data-frames.html#cb930-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols      =</span> <span class="fu">c</span>(<span class="sc">-</span>id, <span class="sc">-</span>sex),</span>
<span id="cb930-4"><a href="restructuring-data-frames.html#cb930-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to  =</span> <span class="st">&quot;months&quot;</span>,</span>
<span id="cb930-5"><a href="restructuring-data-frames.html#cb930-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;weight&quot;</span></span>
<span id="cb930-6"><a href="restructuring-data-frames.html#cb930-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb930-7"><a href="restructuring-data-frames.html#cb930-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code></pre></div>
<pre><code>## # A tibble: 64 × 4
##       id sex   months    weight
##    &lt;int&gt; &lt;chr&gt; &lt;chr&gt;      &lt;dbl&gt;
##  1  1001 F     weight_3       9
##  2  1001 F     weight_6      13
##  3  1001 F     weight_9      16
##  4  1001 F     weight_12     17
##  5  1001 F     length_3      17
##  6  1001 F     length_6      18
##  7  1001 F     length_9      19
##  8  1001 F     length_12     21
##  9  1002 F     weight_3      11
## 10  1002 F     weight_6      16
## # … with 54 more rows</code></pre>
<p>Additionally, not all the values in the third column (i.e., <code>weight</code>) are weights. Half of those values are lengths. So, we also need to drop the <code>values_to</code> argument:</p>
<div class="sourceCode" id="cb932"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb932-1"><a href="restructuring-data-frames.html#cb932-1" aria-hidden="true" tabindex="-1"></a>babies_long <span class="ot">&lt;-</span> babies <span class="sc">%&gt;%</span> </span>
<span id="cb932-2"><a href="restructuring-data-frames.html#cb932-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb932-3"><a href="restructuring-data-frames.html#cb932-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols     =</span> <span class="fu">c</span>(<span class="sc">-</span>id, <span class="sc">-</span>sex),</span>
<span id="cb932-4"><a href="restructuring-data-frames.html#cb932-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;months&quot;</span></span>
<span id="cb932-5"><a href="restructuring-data-frames.html#cb932-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb932-6"><a href="restructuring-data-frames.html#cb932-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code></pre></div>
<pre><code>## # A tibble: 64 × 4
##       id sex   months    value
##    &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;dbl&gt;
##  1  1001 F     weight_3      9
##  2  1001 F     weight_6     13
##  3  1001 F     weight_9     16
##  4  1001 F     weight_12    17
##  5  1001 F     length_3     17
##  6  1001 F     length_6     18
##  7  1001 F     length_9     19
##  8  1001 F     length_12    21
##  9  1002 F     weight_3     11
## 10  1002 F     weight_6     16
## # … with 54 more rows</code></pre>
<p>Believe it or not, we are actually pretty close to accomplishing our goal. Next, we need to somehow tell <code>pivot_longer()</code> that the column names we are pivoting contain a description of the values (i.e., heights and weights) <em>and</em> time values (i.e., 3, 6, 9, and 12 months). Notice that in all cases, the description and the time value are separated by an underscore. It turns out that we can use the <code>names_sep</code> argument to give <code>pivot_longer()</code> this information.</p>
</div>
<div id="the-names_sep-argument" class="section level3" number="31.2.6">
<h3><span class="header-section-number">31.2.6</span> The names_sep argument</h3>
<p>Let’s start by simply passing the adding the <code>names_sep</code> argument to the <code>pivot_longer()</code> function and pass it the value that separates our description and our time value:</p>
<div class="sourceCode" id="cb934"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb934-1"><a href="restructuring-data-frames.html#cb934-1" aria-hidden="true" tabindex="-1"></a>babies_long <span class="ot">&lt;-</span> babies <span class="sc">%&gt;%</span> </span>
<span id="cb934-2"><a href="restructuring-data-frames.html#cb934-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb934-3"><a href="restructuring-data-frames.html#cb934-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols      =</span> <span class="fu">c</span>(<span class="sc">-</span>id, <span class="sc">-</span>sex),</span>
<span id="cb934-4"><a href="restructuring-data-frames.html#cb934-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to  =</span> <span class="st">&quot;months&quot;</span>,</span>
<span id="cb934-5"><a href="restructuring-data-frames.html#cb934-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span></span>
<span id="cb934-6"><a href="restructuring-data-frames.html#cb934-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb934-7"><a href="restructuring-data-frames.html#cb934-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code></pre></div>
<pre><code>## Error: `names_sep` can not be used with length-1 `names_to`</code></pre>
<p>And we get an error. The reason we get an error can be seen in the following figure:</p>
<p><img src="img/05_part_data_management/10_restructuring/names_sep1.png" width="900" /></p>
<p>We are asking <code>pivot_longer()</code> to break up each column name (e.g., <code>weight_3</code>) at the underscore. That results in creating two separate character strings. In this case, the character string “weight” and the character string “3.” However, we only passed one value to the <code>names_to</code> argument – <code>"months"</code>. So, which character string should <code>pivot_longer()</code> put in the <code>months</code> column? Of course, we know that the answer is “3,” but <code>pivot_longer()</code> doesn’t know that.</p>
<p>So, we have to pass two values to the names_to argument. But, what values should we pass?</p>
<p><img src="img/05_part_data_management/10_restructuring/names_sep2.png" width="900" /></p>
<p>We obviously want to character string that comes after the underscore to be called “months.” However, we can’t call the character string in front of the underscore “weight” because this column isn’t just identifying rows that contain weights. Similarly, we can’t call the character string in front of the underscore “length” because this column isn’t just identifying rows that contain lengths. For lack of a better idea, let’s just call it “measure.”</p>
<div class="sourceCode" id="cb936"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb936-1"><a href="restructuring-data-frames.html#cb936-1" aria-hidden="true" tabindex="-1"></a>babies_long <span class="ot">&lt;-</span> babies <span class="sc">%&gt;%</span> </span>
<span id="cb936-2"><a href="restructuring-data-frames.html#cb936-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb936-3"><a href="restructuring-data-frames.html#cb936-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols      =</span> <span class="fu">c</span>(<span class="sc">-</span>id, <span class="sc">-</span>sex),</span>
<span id="cb936-4"><a href="restructuring-data-frames.html#cb936-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to  =</span> <span class="fu">c</span>(<span class="st">&quot;measure&quot;</span>, <span class="st">&quot;months&quot;</span>),</span>
<span id="cb936-5"><a href="restructuring-data-frames.html#cb936-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span></span>
<span id="cb936-6"><a href="restructuring-data-frames.html#cb936-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb936-7"><a href="restructuring-data-frames.html#cb936-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code></pre></div>
<pre><code>## # A tibble: 64 × 5
##       id sex   measure months value
##    &lt;int&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;dbl&gt;
##  1  1001 F     weight  3          9
##  2  1001 F     weight  6         13
##  3  1001 F     weight  9         16
##  4  1001 F     weight  12        17
##  5  1001 F     length  3         17
##  6  1001 F     length  6         18
##  7  1001 F     length  9         19
##  8  1001 F     length  12        21
##  9  1002 F     weight  3         11
## 10  1002 F     weight  6         16
## # … with 54 more rows</code></pre>
<p>That sort of works. Except, what we really want is one row for each combination of id and months, each containing a value for weight and length. Instead, we have two rows for each combination of id and months. One set of rows contains weights and the other set of rows contains lengths.</p>
<p>What we really need is for <code>pivot_longer()</code> to make <code>weight</code> one column and <code>length</code> a separate column, and then put the appropriate values from <code>value</code> under each. We can do this with the <code>.value</code> special value.</p>
</div>
<div id="the-.value-special-value" class="section level3" number="31.2.7">
<h3><span class="header-section-number">31.2.7</span> The .value special value</h3>
<p>The official help documentation for <code>pivot_longer()</code> says that the <code>.value</code> special value “indicates that [the] component of the name defines the name of the column containing the cell values, overriding values_to.” Said another way, <code>.value</code> tells <code>pivot_longer()</code> the character string in front of the underscore is the value description. Further, <code>.value</code> tells <code>pivot_longer()</code> to create a new column for each unique character string that is in front of the underscore.</p>
<p><img src="img/05_part_data_management/10_restructuring/value.png" width="900" /></p>
<p>Now, let’s add the <code>.value</code> special value to our code:</p>
<div class="sourceCode" id="cb938"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb938-1"><a href="restructuring-data-frames.html#cb938-1" aria-hidden="true" tabindex="-1"></a>babies_long <span class="ot">&lt;-</span> babies <span class="sc">%&gt;%</span> </span>
<span id="cb938-2"><a href="restructuring-data-frames.html#cb938-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb938-3"><a href="restructuring-data-frames.html#cb938-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols      =</span> <span class="fu">c</span>(<span class="sc">-</span>id, <span class="sc">-</span>sex),</span>
<span id="cb938-4"><a href="restructuring-data-frames.html#cb938-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to  =</span> <span class="fu">c</span>(<span class="st">&quot;.value&quot;</span>, <span class="st">&quot;months&quot;</span>),</span>
<span id="cb938-5"><a href="restructuring-data-frames.html#cb938-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>,</span>
<span id="cb938-6"><a href="restructuring-data-frames.html#cb938-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_transform =</span> <span class="fu">list</span>(<span class="at">months =</span> as.integer)</span>
<span id="cb938-7"><a href="restructuring-data-frames.html#cb938-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb938-8"><a href="restructuring-data-frames.html#cb938-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code></pre></div>
<pre><code>## # A tibble: 32 × 5
##       id sex   months weight length
##    &lt;int&gt; &lt;chr&gt;  &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1  1001 F          3      9     17
##  2  1001 F          6     13     18
##  3  1001 F          9     16     19
##  4  1001 F         12     17     21
##  5  1002 F          3     11     19
##  6  1002 F          6     16     21
##  7  1002 F          9     17     23
##  8  1002 F         12     20     23
##  9  1003 M          3     17     23
## 10  1003 M          6     20     27
## # … with 22 more rows</code></pre>
<p>And that is exactly the result we wanted. However, there was one little detail we didn’t cover. How does <code>.value</code> know to create a new column for each unique character string that is in <em>front</em> of the underscore. Why didn’t it create a new column for each unique character string that is <em>behind</em> the underscore?</p>
<p>The answer is simple. It knows because of the ordering we used in the value we passed to the <code>names_to</code> argument. If we changed the order to <code>c("months", ".value")</code>, <code>pivot_longer()</code> would have created a new column for each unique character string that is <em>behind</em> the underscore. Take a look:</p>
<div class="sourceCode" id="cb940"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb940-1"><a href="restructuring-data-frames.html#cb940-1" aria-hidden="true" tabindex="-1"></a>babies <span class="sc">%&gt;%</span> </span>
<span id="cb940-2"><a href="restructuring-data-frames.html#cb940-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb940-3"><a href="restructuring-data-frames.html#cb940-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols      =</span> <span class="fu">c</span>(<span class="sc">-</span>id, <span class="sc">-</span>sex),</span>
<span id="cb940-4"><a href="restructuring-data-frames.html#cb940-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to  =</span> <span class="fu">c</span>(<span class="st">&quot;months&quot;</span>, <span class="st">&quot;.value&quot;</span>),</span>
<span id="cb940-5"><a href="restructuring-data-frames.html#cb940-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span></span>
<span id="cb940-6"><a href="restructuring-data-frames.html#cb940-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 16 × 7
##       id sex   months   `3`   `6`   `9`  `12`
##    &lt;int&gt; &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  1001 F     weight     9    13    16    17
##  2  1001 F     length    17    18    19    21
##  3  1002 F     weight    11    16    17    20
##  4  1002 F     length    19    21    23    23
##  5  1003 M     weight    17    20    23    24
##  6  1003 M     length    23    27    30    33
##  7  1004 F     weight    16    18    21    22
##  8  1004 F     length    20    22    24    26
##  9  1005 M     weight    11    15    16    18
## 10  1005 M     length    18    20    22    23
## 11  1006 M     weight    17    21    25    26
## 12  1006 M     length    22    26    28    30
## 13  1007 M     weight    16    17    19    21
## 14  1007 M     length    21    23    24    25
## 15  1008 F     weight    15    16    18    19
## 16  1008 F     length    18    19    23    24</code></pre>
<p>So, be careful about the ordering of the values you pass to the <code>names_to</code> argument.</p>
</div>
<div id="why-person-period" class="section level3" number="31.2.8">
<h3><span class="header-section-number">31.2.8</span> Why person-period?</h3>
<p>Why might we want the <code>babies</code> data in this person-period format? Well, as we discussed above, there are many analytic techniques that require our data to be in this format. Unfortunately, those techniques are beyond the scope of this chapter. However, this person-period format is still necessary for something as simple as plotting baby weight against baby height as we’ve done in the scatter plot below:</p>
<div class="sourceCode" id="cb942"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb942-1"><a href="restructuring-data-frames.html#cb942-1" aria-hidden="true" tabindex="-1"></a>babies_long <span class="sc">%&gt;%</span> </span>
<span id="cb942-2"><a href="restructuring-data-frames.html#cb942-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">months =</span> <span class="fu">factor</span>(months, <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb942-3"><a href="restructuring-data-frames.html#cb942-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb942-4"><a href="restructuring-data-frames.html#cb942-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(weight, length, <span class="at">color =</span> months)) <span class="sc">+</span></span>
<span id="cb942-5"><a href="restructuring-data-frames.html#cb942-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb942-6"><a href="restructuring-data-frames.html#cb942-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">&quot;Weight (Pounds)&quot;</span>,</span>
<span id="cb942-7"><a href="restructuring-data-frames.html#cb942-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">&quot;Length (Inches)&quot;</span>,</span>
<span id="cb942-8"><a href="restructuring-data-frames.html#cb942-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">&quot;Age (Months)&quot;</span></span>
<span id="cb942-9"><a href="restructuring-data-frames.html#cb942-9" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb942-10"><a href="restructuring-data-frames.html#cb942-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_classic</span>()</span></code></pre></div>
<p><img src="R-4-Epidemiology_files/figure-html/unnamed-chunk-698-1.png" width="672" /></p>
</div>
</div>
<div id="pivoting-wider" class="section level2" number="31.3">
<h2><span class="header-section-number">31.3</span> Pivoting wider</h2>
<p>As previously discussed, the person-period, or long, data structure is <em>usually</em> preferable for longitudinal data analysis. However, there are times when the person-level data structure is preferable, or even necessary. Further, there are times when we have tables of analysis results, as opposed than actual data values, that we need to restructure for ease of interpretation. We will demonstrate how to do both below.</p>
<p>We’ll start by learning how to restructure, or reshape, our person-period <code>babies_long</code> data frame back to a person-level format. As a reminder, here is what our <code>babies_long</code> data frame currently looks like:</p>
<div class="sourceCode" id="cb943"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb943-1"><a href="restructuring-data-frames.html#cb943-1" aria-hidden="true" tabindex="-1"></a>babies_long</span></code></pre></div>
<pre><code>## # A tibble: 32 × 5
##       id sex   months weight length
##    &lt;int&gt; &lt;chr&gt;  &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1  1001 F          3      9     17
##  2  1001 F          6     13     18
##  3  1001 F          9     16     19
##  4  1001 F         12     17     21
##  5  1002 F          3     11     19
##  6  1002 F          6     16     21
##  7  1002 F          9     17     23
##  8  1002 F         12     20     23
##  9  1003 M          3     17     23
## 10  1003 M          6     20     27
## # … with 22 more rows</code></pre>
<p>As you probably guessed, we will use <code>tidyr</code>’s <code>pivot_wider()</code> function to restructure the data:</p>
<div class="sourceCode" id="cb945"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb945-1"><a href="restructuring-data-frames.html#cb945-1" aria-hidden="true" tabindex="-1"></a>babies <span class="ot">&lt;-</span> babies_long <span class="sc">%&gt;%</span> </span>
<span id="cb945-2"><a href="restructuring-data-frames.html#cb945-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb945-3"><a href="restructuring-data-frames.html#cb945-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from  =</span> <span class="st">&quot;months&quot;</span>,</span>
<span id="cb945-4"><a href="restructuring-data-frames.html#cb945-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(<span class="st">&quot;weight&quot;</span>, <span class="st">&quot;length&quot;</span>)</span>
<span id="cb945-5"><a href="restructuring-data-frames.html#cb945-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb945-6"><a href="restructuring-data-frames.html#cb945-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code></pre></div>
<pre><code>## # A tibble: 8 × 10
##      id sex   weight_3 weight_6 weight_9 weight_12 length_3 length_6 length_9 length_12
##   &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1  1001 F            9       13       16        17       17       18       19        21
## 2  1002 F           11       16       17        20       19       21       23        23
## 3  1003 M           17       20       23        24       23       27       30        33
## 4  1004 F           16       18       21        22       20       22       24        26
## 5  1005 M           11       15       16        18       18       20       22        23
## 6  1006 M           17       21       25        26       22       26       28        30
## 7  1007 M           16       17       19        21       21       23       24        25
## 8  1008 F           15       16       18        19       18       19       23        24</code></pre>
<p>👆<strong>Here’s what we did above:</strong></p>
<ul>
<li><p>We used <code>tidyr</code>’s <code>pivot_wider()</code> function to restructure the <code>babies_long</code> data frame from person-period (long) to person-level (wide).</p></li>
<li><p>You can type <code>?pivot_wider</code> into your R console to view the help documentation for this function and follow along with the explanation below.</p></li>
<li><p>The first argument to the <code>pivot_wider()</code> function is the <code>data</code> argument. You should pass the name of the data frame you want to restructure to the <code>data</code> argument. Above, we passed the <code>babies_long</code> data frame to the <code>data</code> argument using a pipe operator.</p></li>
<li><p>The third argument (we left the second argument at its default value) to the <code>pivot_wider()</code> function is the <code>names_from</code> argument. You should pass this argument the name of a column, or columns, that exists in the data frame you passed to the <code>data</code> argument. The column(s) you choose should contain values that you want to become column names in the wide data frame. That’s a little be confusing, and our example above is sort of subtle, so here is a more obvious example:</p></li>
</ul>
<div class="sourceCode" id="cb947"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb947-1"><a href="restructuring-data-frames.html#cb947-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb947-2"><a href="restructuring-data-frames.html#cb947-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>id, <span class="sc">~</span>measure, <span class="sc">~</span>lbs_inches,</span>
<span id="cb947-3"><a href="restructuring-data-frames.html#cb947-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>, <span class="st">&quot;weight&quot;</span>, <span class="dv">9</span>,</span>
<span id="cb947-4"><a href="restructuring-data-frames.html#cb947-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span>, <span class="st">&quot;length&quot;</span>, <span class="dv">17</span>,</span>
<span id="cb947-5"><a href="restructuring-data-frames.html#cb947-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>, <span class="st">&quot;weight&quot;</span>, <span class="dv">11</span>,</span>
<span id="cb947-6"><a href="restructuring-data-frames.html#cb947-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span>, <span class="st">&quot;length&quot;</span>, <span class="dv">19</span> </span>
<span id="cb947-7"><a href="restructuring-data-frames.html#cb947-7" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb947-8"><a href="restructuring-data-frames.html#cb947-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code></pre></div>
<pre><code>## # A tibble: 4 × 3
##      id measure lbs_inches
##   &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;
## 1     1 weight           9
## 2     1 length          17
## 3     2 weight          11
## 4     2 length          19</code></pre>
<ul>
<li>In the data frame above, the values in the column named <code>measure</code> are what we want to use as column names in our wide data frame. Therefore, we would pass <code>"measure"</code> to the <code>names_to</code> argument of <code>pivot_wider()</code>:</li>
</ul>
<div class="sourceCode" id="cb949"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb949-1"><a href="restructuring-data-frames.html#cb949-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(</span>
<span id="cb949-2"><a href="restructuring-data-frames.html#cb949-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_from  =</span> <span class="st">&quot;measure&quot;</span>,</span>
<span id="cb949-3"><a href="restructuring-data-frames.html#cb949-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_from =</span> <span class="st">&quot;lbs_inches&quot;</span></span>
<span id="cb949-4"><a href="restructuring-data-frames.html#cb949-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##      id weight length
##   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1     1      9     17
## 2     2     11     19</code></pre>
<ul>
<li><p>Our <code>babies</code> example was more subtle in the sense that the long version of our data frame already had columns named <code>weight</code> and <code>height</code>. However, we essentially wanted to <em>change</em> those column names by <em>adding</em> the values from the column named <code>months</code> to the current column names. So, <code>weight</code> to <code>weight_3</code>, with the “3” coming from the column <code>months</code>.</p></li>
<li><p>The ninth argument (we left the fourth through eighth arguments at their default value) to the <code>pivot_wider()</code> function is the <code>values_from</code> argument. You should pass this argument the name of a column, or columns, that exists in the data frame you passed to the <code>data</code> argument. The column(s) you choose should contain values for the new columns you want to create in the new wide data frame. In our <code>babies</code> data frame, we wanted to pull the values from the <code>weight</code> and <code>length</code> columns respectively.</p></li>
<li><p>The combination of arguments (i.e., <code>names_from  = "months"</code> and <code>values_from = c("weight", "length")</code>) that we passed to <code>pivot_wider()</code> above essentially said, "make new columns from each combination of the values in the column named <code>months</code> and the column names <code>weight</code> and <code>length</code>. So, <code>weight_3</code>, <code>weight_6</code>, etc. Then, the values you put in each column should come from the intersection of <code>month</code> and <code>weight</code> (for the <code>weight_#</code>) columns, or <code>month</code> and <code>length</code> (for the <code>length_#</code>) columns.</p></li>
</ul>
<div id="why-person-level" class="section level3" number="31.3.1">
<h3><span class="header-section-number">31.3.1</span> Why person-level?</h3>
<p>Why might we want the <code>babies</code> data in this person-level format? Well, as we discussed above, there are a handful analytic techniques that require our data to be in this format. Unfortunately, those techniques are beyond the scope of this chapter. However, this person-level format is still useful for something as simple as calculating descriptive statistics about time-invariant variables. For example, the number of female and male babies in our data frame:</p>
<div class="sourceCode" id="cb951"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb951-1"><a href="restructuring-data-frames.html#cb951-1" aria-hidden="true" tabindex="-1"></a>babies <span class="sc">%&gt;%</span> </span>
<span id="cb951-2"><a href="restructuring-data-frames.html#cb951-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sex)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 2
##   sex       n
##   &lt;chr&gt; &lt;int&gt;
## 1 F         4
## 2 M         4</code></pre>
</div>
</div>
<div id="pivoting-summary-statistics" class="section level2" number="31.4">
<h2><span class="header-section-number">31.4</span> Pivoting summary statistics</h2>
<p>What do I mean by pivoting “summary statistics?” Well, in all the examples above we were manipulating the actual data values that were gathered about our observational units – babies. However, the ultimate goal of doing this kind of data management is typically to analyze it. In other words, we can often learn more from collapsing our data into a relatively small number of summary statistics than we can by viewing the actual data values themselves. Having said that, not all ways of organizing our summary statistics are equally informative. Or, perhaps it’s more accurate to say that not all ways of organizing our summary statistics convey the information with equal efficiency.</p>
<p>There are probably a near-infinite number of possible examples of manipulating summary statistics that we could discuss. Obviously, I can’t cover them all. However, I will walk through two examples below that are intended to give you a feel for what we are talking about.</p>
<div id="pivoting-summary-statistics-wide-to-long" class="section level3" number="31.4.1">
<h3><span class="header-section-number">31.4.1</span> Pivoting summary statistics wide to long</h3>
<p>Our first example is a pretty simple one. Let’s say that we are working with our person-level <code>babies</code> data frame. In this scenario, we want to calculate the mean and standard deviation of weight at the 3, 6, 9, and 12-month follow-up visits. We might do the calculations like this:</p>
<div class="sourceCode" id="cb953"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb953-1"><a href="restructuring-data-frames.html#cb953-1" aria-hidden="true" tabindex="-1"></a>mean_weights <span class="ot">&lt;-</span> babies <span class="sc">%&gt;%</span> </span>
<span id="cb953-2"><a href="restructuring-data-frames.html#cb953-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb953-3"><a href="restructuring-data-frames.html#cb953-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(weight_3),</span>
<span id="cb953-4"><a href="restructuring-data-frames.html#cb953-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sd</span>(weight_3),</span>
<span id="cb953-5"><a href="restructuring-data-frames.html#cb953-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(weight_6),</span>
<span id="cb953-6"><a href="restructuring-data-frames.html#cb953-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sd</span>(weight_6),</span>
<span id="cb953-7"><a href="restructuring-data-frames.html#cb953-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(weight_9),</span>
<span id="cb953-8"><a href="restructuring-data-frames.html#cb953-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sd</span>(weight_9),</span>
<span id="cb953-9"><a href="restructuring-data-frames.html#cb953-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(weight_12),</span>
<span id="cb953-10"><a href="restructuring-data-frames.html#cb953-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sd</span>(weight_12),</span>
<span id="cb953-11"><a href="restructuring-data-frames.html#cb953-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb953-12"><a href="restructuring-data-frames.html#cb953-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code></pre></div>
<pre><code>## # A tibble: 1 × 8
##   `mean(weight_3)` `sd(weight_3)` `mean(weight_6)` `sd(weight_6)` `mean(weight_9)` `sd(weight_9)` `mean(weight_12)` `sd(weight_12)`
##              &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;          &lt;dbl&gt;             &lt;dbl&gt;           &lt;dbl&gt;
## 1               14           3.16               17           2.62             19.4           3.34              20.9            3.04</code></pre>
<p class="note">
🗒<strong>Side Note:</strong> This is not the most efficient way to do this analysis. We are only doing the analysis in this way to give us an excuse to use <code>pivot_longer()</code> to restructure some summary statistics.
</p>
<p>By default, the mean and standard deviation are organized in a single row, side-by-side. One issue with organizing our results this way is that is that they don’t all fit on the screen at the same time. However, even if they did, it’s much more difficult for our brains to quickly scan the numbers and make comparisons across months when the summary statistics are organized this way than when they are stacked on top of each other. Take a look for yourself below:</p>
<div class="sourceCode" id="cb955"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb955-1"><a href="restructuring-data-frames.html#cb955-1" aria-hidden="true" tabindex="-1"></a>mean_weights <span class="sc">%&gt;%</span> </span>
<span id="cb955-2"><a href="restructuring-data-frames.html#cb955-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb955-3"><a href="restructuring-data-frames.html#cb955-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb955-4"><a href="restructuring-data-frames.html#cb955-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;.value&quot;</span>, <span class="st">&quot;measure&quot;</span>, <span class="st">&quot;months&quot;</span>),</span>
<span id="cb955-5"><a href="restructuring-data-frames.html#cb955-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_pattern =</span> <span class="st">&quot;(</span><span class="sc">\\</span><span class="st">w+)</span><span class="sc">\\</span><span class="st">((</span><span class="sc">\\</span><span class="st">w+)_(</span><span class="sc">\\</span><span class="st">d+)&quot;</span></span>
<span id="cb955-6"><a href="restructuring-data-frames.html#cb955-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 4 × 4
##   measure months  mean    sd
##   &lt;chr&gt;   &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1 weight  3       14    3.16
## 2 weight  6       17    2.62
## 3 weight  9       19.4  3.34
## 4 weight  12      20.9  3.04</code></pre>
<p>👆<strong>Here’s what we did above:</strong></p>
<ul>
<li><p>We used <code>tidyr</code>’s <code>pivot_longer()</code> function to restructure our data frame of summary statistics from wide to long.</p></li>
<li><p>The only new argument above is the <code>names_pattern</code> argument. You should pass a regular expression to the <code>names_pattern</code> argument. This regular expression will tell <code>pivot_longer()</code> how to break up the original column names and repurpose them for the new column names. The regular expression we used above is not intended to be the main lesson here. But, I’m sure that some of you will be curious about how it works, so I will try to briefly explain it below. In a way, this is how R interprets the regular expression above (feel free to skip if you aren’t interested):</p></li>
</ul>
<div class="sourceCode" id="cb957"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb957-1"><a href="restructuring-data-frames.html#cb957-1" aria-hidden="true" tabindex="-1"></a>stringr<span class="sc">::</span><span class="fu">str_match</span>(<span class="st">&quot;mean(weight_3)&quot;</span>, <span class="st">&quot;(</span><span class="sc">\\</span><span class="st">w+)</span><span class="sc">\\</span><span class="st">((</span><span class="sc">\\</span><span class="st">w+)_(</span><span class="sc">\\</span><span class="st">d+)&quot;</span>)</span></code></pre></div>
<pre><code>##      [,1]            [,2]   [,3]     [,4]
## [1,] &quot;mean(weight_3&quot; &quot;mean&quot; &quot;weight&quot; &quot;3&quot;</code></pre>
<ul>
<li><p>We haven’t used parentheses yet in our regular expressions, but they create something called “capturing groups.” Instead of saying, “look for this <em>one thing</em> in the character string,” we say “look for these <em>groups of things</em> in this character string.”</p></li>
<li><p>The first capture group in the regular expression is <code>(\\w+)</code>. This tells R to look for one or more word characters. The value that R grabs as part of this first capture group is given under the second result (i.e., <code>[,2]</code>) above – <code>"mean"</code>.</p></li>
<li><p>Then, the regular expression tells R to look for a literal open parenthesis <code>\\(</code>. However, this parenthesis is not included in a capture group. In this case, it’s really just used as landmark to tell R where the first capture group stops, and the second capture group starts.</p></li>
<li><p>The second capture group in the regular expression is another <code>(\\w+)</code>. This again tells R to look for one or more word characters, but this time, R starts look for the word characters <em>after</em> the open parenthesis. The value that R grabs as part of the second capture group is given under the third result (i.e., <code>[,3]</code>) above – <code>"weight"</code>.</p></li>
<li><p>Next, the regular expression tells R to look for a literal underscore <code>_</code>. However, this underscore is not included in a capture group. In this case, it’s really just used as landmark to tell R where the second capture group stops, and the third capture group starts.</p></li>
<li><p>The third and final capture group in the regular expression is <code>(\\d+)</code>. This tells R to look for one or more digits after the underscore. The value that R grabs as part of the third capture group is given under the third result (i.e., <code>[,4]</code>) above – <code>"3"</code>.</p></li>
<li><p>Finally, R matches the values it grabs in each of the three capture groups with the three values passed to the <code>names_to</code> argument, which are <code>".value"</code>, <code>"measure"</code>, and <code>"months"</code>. We already discussed the .value special value above. Similar to before, .value will create a new column for each unique value captured in the first capture group. In this case, <code>mean</code> and <code>sd</code>. Next, the values captured in the second capture group are assigned to a column named <code>measure</code>. Finally, the values captured in the third capture group are assigned to a column named <code>months</code>.</p></li>
</ul>
</div>
<div id="pivoting-summary-statistics-long-to-wide" class="section level3" number="31.4.2">
<h3><span class="header-section-number">31.4.2</span> Pivoting summary statistics long to wide</h3>
<p>This next example comes from an actual project I was involved with. As a part of this project, researchers asked the parents of elementary-aged children about series of sun protection behaviors. Below, I’m not simulating the data that was collected. Rather, I am simulating a small part of the results of one of the early descriptive analyses we conducted:</p>
<div class="sourceCode" id="cb959"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb959-1"><a href="restructuring-data-frames.html#cb959-1" aria-hidden="true" tabindex="-1"></a>summary_stats <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb959-2"><a href="restructuring-data-frames.html#cb959-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>period, <span class="sc">~</span>behavior, <span class="sc">~</span>value, <span class="sc">~</span>n, <span class="sc">~</span>n_total, <span class="sc">~</span>percent,</span>
<span id="cb959-3"><a href="restructuring-data-frames.html#cb959-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;School Year Weekends&quot;</span>, <span class="st">&quot;Long sleeve shirt&quot;</span>, <span class="st">&quot;Never&quot;</span>, <span class="dv">6</span>, <span class="dv">78</span>,  <span class="dv">8</span>,  </span>
<span id="cb959-4"><a href="restructuring-data-frames.html#cb959-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;School Year Weekends&quot;</span>, <span class="st">&quot;Long sleeve shirt&quot;</span>, <span class="st">&quot;Seldom&quot;</span>, <span class="dv">16</span>, <span class="dv">78</span>,    <span class="dv">21</span>, </span>
<span id="cb959-5"><a href="restructuring-data-frames.html#cb959-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;School Year Weekends&quot;</span>, <span class="st">&quot;Long sleeve shirt&quot;</span>, <span class="st">&quot;Sometimes&quot;</span>, <span class="dv">33</span>, <span class="dv">78</span>, <span class="dv">42</span>, </span>
<span id="cb959-6"><a href="restructuring-data-frames.html#cb959-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;School Year Weekends&quot;</span>, <span class="st">&quot;Long sleeve shirt&quot;</span>, <span class="st">&quot;Often&quot;</span>, <span class="dv">17</span>, <span class="dv">78</span>, <span class="dv">22</span>, </span>
<span id="cb959-7"><a href="restructuring-data-frames.html#cb959-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;School Year Weekends&quot;</span>, <span class="st">&quot;Long sleeve shirt&quot;</span>, <span class="st">&quot;Always&quot;</span>, <span class="dv">6</span>, <span class="dv">78</span>, <span class="dv">8</span>,  </span>
<span id="cb959-8"><a href="restructuring-data-frames.html#cb959-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;School Year Weekends&quot;</span>, <span class="st">&quot;Long Pants&quot;</span>, <span class="st">&quot;Never&quot;</span>, <span class="dv">5</span>, <span class="dv">79</span>, <span class="dv">6</span>,  </span>
<span id="cb959-9"><a href="restructuring-data-frames.html#cb959-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;School Year Weekends&quot;</span>, <span class="st">&quot;Long Pants&quot;</span>, <span class="st">&quot;Seldom&quot;</span>,   <span class="dv">15</span>, <span class="dv">79</span>, <span class="dv">19</span>, </span>
<span id="cb959-10"><a href="restructuring-data-frames.html#cb959-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;School Year Weekends&quot;</span>, <span class="st">&quot;Long Pants&quot;</span>, <span class="st">&quot;Sometimes&quot;</span>, <span class="dv">32</span>, <span class="dv">79</span>, <span class="dv">41</span>,    </span>
<span id="cb959-11"><a href="restructuring-data-frames.html#cb959-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;School Year Weekends&quot;</span>, <span class="st">&quot;Long Pants&quot;</span>, <span class="st">&quot;Often&quot;</span>, <span class="dv">19</span>, <span class="dv">79</span>, <span class="dv">24</span>,    </span>
<span id="cb959-12"><a href="restructuring-data-frames.html#cb959-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;School Year Weekends&quot;</span>, <span class="st">&quot;Long Pants&quot;</span>, <span class="st">&quot;Always&quot;</span>,   <span class="dv">8</span>, <span class="dv">79</span>, <span class="dv">10</span>,  </span>
<span id="cb959-13"><a href="restructuring-data-frames.html#cb959-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Summer&quot;</span>, <span class="st">&quot;Long sleeve shirt&quot;</span>, <span class="st">&quot;Never&quot;</span>,   <span class="dv">9</span>, <span class="dv">80</span>, <span class="dv">11</span>,  </span>
<span id="cb959-14"><a href="restructuring-data-frames.html#cb959-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Summer&quot;</span>, <span class="st">&quot;Long sleeve shirt&quot;</span>, <span class="st">&quot;Seldom&quot;</span>, <span class="dv">18</span>, <span class="dv">80</span>, <span class="dv">22</span>,  </span>
<span id="cb959-15"><a href="restructuring-data-frames.html#cb959-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Summer&quot;</span>, <span class="st">&quot;Long sleeve shirt&quot;</span>, <span class="st">&quot;Sometimes&quot;</span>, <span class="dv">31</span>,   <span class="dv">80</span>, <span class="dv">39</span>, </span>
<span id="cb959-16"><a href="restructuring-data-frames.html#cb959-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Summer&quot;</span>, <span class="st">&quot;Long sleeve shirt&quot;</span>, <span class="st">&quot;Often&quot;</span>,   <span class="dv">14</span>, <span class="dv">80</span>, <span class="dv">18</span>, </span>
<span id="cb959-17"><a href="restructuring-data-frames.html#cb959-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Summer&quot;</span>, <span class="st">&quot;Long sleeve shirt&quot;</span>, <span class="st">&quot;Always&quot;</span>, <span class="dv">8</span>,   <span class="dv">80</span>, <span class="dv">10</span>, </span>
<span id="cb959-18"><a href="restructuring-data-frames.html#cb959-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Summer&quot;</span>, <span class="st">&quot;Long Pants&quot;</span>, <span class="st">&quot;Never&quot;</span>, <span class="dv">7</span>,   <span class="dv">76</span>, <span class="dv">9</span>,  </span>
<span id="cb959-19"><a href="restructuring-data-frames.html#cb959-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Summer&quot;</span>, <span class="st">&quot;Long Pants&quot;</span>, <span class="st">&quot;Seldom&quot;</span>, <span class="dv">16</span>, <span class="dv">76</span>, <span class="dv">21</span>, </span>
<span id="cb959-20"><a href="restructuring-data-frames.html#cb959-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Summer&quot;</span>, <span class="st">&quot;Long Pants&quot;</span>, <span class="st">&quot;Sometimes&quot;</span>, <span class="dv">27</span>,  <span class="dv">76</span>, <span class="dv">36</span>, </span>
<span id="cb959-21"><a href="restructuring-data-frames.html#cb959-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Summer&quot;</span>, <span class="st">&quot;Long Pants&quot;</span>, <span class="st">&quot;Often&quot;</span>, <span class="dv">18</span>, <span class="dv">76</span>,  <span class="dv">24</span>, </span>
<span id="cb959-22"><a href="restructuring-data-frames.html#cb959-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Summer&quot;</span>, <span class="st">&quot;Long Pants&quot;</span>, <span class="st">&quot;Always&quot;</span>, <span class="dv">8</span>, <span class="dv">76</span>,  <span class="dv">11</span></span>
<span id="cb959-23"><a href="restructuring-data-frames.html#cb959-23" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb959-24"><a href="restructuring-data-frames.html#cb959-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code></pre></div>
<pre><code>## # A tibble: 20 × 6
##    period               behavior          value         n n_total percent
##    &lt;chr&gt;                &lt;chr&gt;             &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1 School Year Weekends Long sleeve shirt Never         6      78       8
##  2 School Year Weekends Long sleeve shirt Seldom       16      78      21
##  3 School Year Weekends Long sleeve shirt Sometimes    33      78      42
##  4 School Year Weekends Long sleeve shirt Often        17      78      22
##  5 School Year Weekends Long sleeve shirt Always        6      78       8
##  6 School Year Weekends Long Pants        Never         5      79       6
##  7 School Year Weekends Long Pants        Seldom       15      79      19
##  8 School Year Weekends Long Pants        Sometimes    32      79      41
##  9 School Year Weekends Long Pants        Often        19      79      24
## 10 School Year Weekends Long Pants        Always        8      79      10
## 11 Summer               Long sleeve shirt Never         9      80      11
## 12 Summer               Long sleeve shirt Seldom       18      80      22
## 13 Summer               Long sleeve shirt Sometimes    31      80      39
## 14 Summer               Long sleeve shirt Often        14      80      18
## 15 Summer               Long sleeve shirt Always        8      80      10
## 16 Summer               Long Pants        Never         7      76       9
## 17 Summer               Long Pants        Seldom       16      76      21
## 18 Summer               Long Pants        Sometimes    27      76      36
## 19 Summer               Long Pants        Often        18      76      24
## 20 Summer               Long Pants        Always        8      76      11</code></pre>
<ul>
<li><p>The <code>period</code> column contains the time frame the researchers were asking the parents about. It can take the values <code>School Year Weekends</code> or <code>Summer</code>.</p></li>
<li><p>The <code>behavior</code> column contains each of the specific behaviors that the researchers were interested in. Above, <code>behavior</code> takes only the values <code>Long sleeve shirt</code> and <code>Long Pants</code>.</p></li>
<li><p>The <code>value</code> column contains the possible answer choices that parents could select from.</p></li>
<li><p>The <code>n</code> column contains the number of parents who selected the response in <code>value</code> for the behavior in <code>behavior</code> and the time frame in <code>period</code>. For example, <code>n</code> = 6 in the first row indicates that six parents said that their child never wears long sleeve shirts on weekends during the school year.</p></li>
<li><p>The <code>n_total</code> column is the sum of <code>n</code> for each period/behavior combination.</p></li>
<li><p>The <code>percent</code> column contains the percentage of parents who selected the response in <code>value</code> for the behavior in <code>behavior</code> and the time frame in <code>period</code>. For example, <code>percent</code> = 8 in the first row indicates that 8 percent of parents said that their child never wears long sleeve shirts on weekends during the school year.</p></li>
</ul>
<p>These results are relatively difficult to scan and get a feel for. In particular, these researchers were interested in whether or not engagement in these protective behaviors differed by period. In other words, were kids more likely to wear long sleeve shirts on weekends during the school year than they were during the summer? It’s difficult to answer that quickly with the way the summary statistics above are organized. We can improve the interpretability of our results by combining <code>n</code> and <code>percent</code> into a single character string, and pivoting them wider so that the two periods are presented side-by-side:</p>
<div class="sourceCode" id="cb961"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb961-1"><a href="restructuring-data-frames.html#cb961-1" aria-hidden="true" tabindex="-1"></a>summary_stats <span class="sc">%&gt;%</span> </span>
<span id="cb961-2"><a href="restructuring-data-frames.html#cb961-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine n and percent into a single character string</span></span>
<span id="cb961-3"><a href="restructuring-data-frames.html#cb961-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_percent =</span> <span class="fu">paste0</span>(n, <span class="st">&quot; (&quot;</span>, percent, <span class="st">&quot;)&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb961-4"><a href="restructuring-data-frames.html#cb961-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We no longer need n, n_total, percent</span></span>
<span id="cb961-5"><a href="restructuring-data-frames.html#cb961-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>n<span class="sc">:-</span>percent) <span class="sc">%&gt;%</span> </span>
<span id="cb961-6"><a href="restructuring-data-frames.html#cb961-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb961-7"><a href="restructuring-data-frames.html#cb961-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> <span class="st">&quot;period&quot;</span>,</span>
<span id="cb961-8"><a href="restructuring-data-frames.html#cb961-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="st">&quot;n_percent&quot;</span></span>
<span id="cb961-9"><a href="restructuring-data-frames.html#cb961-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 10 × 4
##    behavior          value     `School Year Weekends` Summer 
##    &lt;chr&gt;             &lt;chr&gt;     &lt;chr&gt;                  &lt;chr&gt;  
##  1 Long sleeve shirt Never     6 (8)                  9 (11) 
##  2 Long sleeve shirt Seldom    16 (21)                18 (22)
##  3 Long sleeve shirt Sometimes 33 (42)                31 (39)
##  4 Long sleeve shirt Often     17 (22)                14 (18)
##  5 Long sleeve shirt Always    6 (8)                  8 (10) 
##  6 Long Pants        Never     5 (6)                  7 (9)  
##  7 Long Pants        Seldom    15 (19)                16 (21)
##  8 Long Pants        Sometimes 32 (41)                27 (36)
##  9 Long Pants        Often     19 (24)                18 (24)
## 10 Long Pants        Always    8 (10)                 8 (11)</code></pre>
<p>The layout of our summary statistics above is now much more compact. Further, it’s much easier to compare behaviors between the two time periods. For example, we can see that a slightly higher percentage of people (11%) reported that their child never wears a long sleeve shirt during the summer as compared to weekends during the school year (8%).</p>
</div>
</div>
<div id="tidy-data" class="section level2" number="31.5">
<h2><span class="header-section-number">31.5</span> Tidy data</h2>
<p>As I said above, the person-level (wide) and person-period (long) data structures are the <em>traditional</em> way of classifying how longitudinal (or repeated measures) data are organized. In reality, however, structuring data in a way that is most conducive to analysis is often more complicated than the examples above would lead you to believe. Simply thinking about data structure in terms of wide and long sometimes leaves us with an incomplete model for how to take many real-world data sets and prepare them for conducting analysis in an efficient way. In his seminal paper on the topic, Hadley Wickham, provides us with a set of guidelines for systematically (re)structuring our data in a way that is consistent, and generally optimized for analysis. He refers to this process as “tidying” our data, and to the resulting data frame as “tidy data.”<span class="citation"><sup><a href="#ref-Wickham2014-gy" role="doc-biblioref">5</a></sup></span></p>
<p class="note">
🗒<strong>Side Note:</strong> If you are interested, you can download the entire article for free from the <a href="https://www.jstatsoft.org/article/view/v059i10">Journal of statistical Software here</a>.
</p>
<p>The three basic guidelines for tidy data are:</p>
<ol style="list-style-type: decimal">
<li><p>Each variable (i.e., measurement or characteristic about the observational unit) must have its own column.</p></li>
<li><p>Each observation (i.e. the people, places, or things we are interested in characterizing or comparing <em>at a particular occasion</em>) must have its own row.</p></li>
<li><p>Each value must have its own cell.</p></li>
</ol>
<p>According to the tidy data philosophy, any data frame that does not conform to the guidelines above is considered “messy” data. In my opinion, it’s kind of hard to read the guidelines above and wrap your head around what tidy data is. I think it’s actually easier to get a <em>feel</em> for tidy data by looking at examples of data that are not tidy. Let’s go ahead and take a look at a few examples:</p>
<div id="each-variable-must-have-its-own-column" class="section level3" number="31.5.1">
<h3><span class="header-section-number">31.5.1</span> Each variable must have its own column</h3>
<p>What does it mean for every variable to have its own column? Well, let’s say we interested the rate of neural tube defects by state. So, we pull some data from a government website that looks like this:</p>
<div class="sourceCode" id="cb963"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb963-1"><a href="restructuring-data-frames.html#cb963-1" aria-hidden="true" tabindex="-1"></a>births_ntd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb963-2"><a href="restructuring-data-frames.html#cb963-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">state   =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;CA&quot;</span>, <span class="st">&quot;FL&quot;</span>, <span class="st">&quot;TX&quot;</span>), <span class="at">each =</span> <span class="dv">2</span>),</span>
<span id="cb963-3"><a href="restructuring-data-frames.html#cb963-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;births&quot;</span>, <span class="st">&quot;neural tube defects&quot;</span>), <span class="dv">3</span>),</span>
<span id="cb963-4"><a href="restructuring-data-frames.html#cb963-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">count   =</span> <span class="fu">c</span>(<span class="dv">454920</span>, <span class="dv">318</span>, <span class="dv">221542</span>, <span class="dv">155</span>, <span class="dv">378624</span>, <span class="dv">265</span>)</span>
<span id="cb963-5"><a href="restructuring-data-frames.html#cb963-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb963-6"><a href="restructuring-data-frames.html#cb963-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   state outcome              count
##   &lt;chr&gt; &lt;chr&gt;                &lt;dbl&gt;
## 1 CA    births              454920
## 2 CA    neural tube defects    318
## 3 FL    births              221542
## 4 FL    neural tube defects    155
## 5 TX    births              378624
## 6 TX    neural tube defects    265</code></pre>
<p>In this case, there is only one <code>count</code> column, but that column really contains two variables: the count of live births and the count of neural tube defects. Further, the <code>outcome</code> column doesn’t really contain “data.” In this case, the values stored in the <code>outcome</code> column are really data <em>labels</em>. We can tidy this data using the <code>pivot_wider()</code> function:</p>
<div class="sourceCode" id="cb965"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb965-1"><a href="restructuring-data-frames.html#cb965-1" aria-hidden="true" tabindex="-1"></a>births_ntd <span class="sc">%&gt;%</span> </span>
<span id="cb965-2"><a href="restructuring-data-frames.html#cb965-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb965-3"><a href="restructuring-data-frames.html#cb965-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from  =</span> <span class="st">&quot;outcome&quot;</span>,</span>
<span id="cb965-4"><a href="restructuring-data-frames.html#cb965-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="st">&quot;count&quot;</span></span>
<span id="cb965-5"><a href="restructuring-data-frames.html#cb965-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   state births `neural tube defects`
##   &lt;chr&gt;  &lt;dbl&gt;                 &lt;dbl&gt;
## 1 CA    454920                   318
## 2 FL    221542                   155
## 3 TX    378624                   265</code></pre>
<p>Now, <code>births</code> and <code>neural tube defects</code> each have their own column. It might also be a good idea to remove the spaces from <code>neural tube defects</code> and make it clear that the values in each column are counts. But, I’m going to leave that to you.</p>
<p>Another common violation of the “each variable must have its own column” guideline is when column names contain data values. We already saw an example of this above. Our <code>weight_</code> and <code>length_</code> column names actually had time data embedded in them.</p>
<p>In the example below, each column name contains two data values (i.e., sex and year); however, neither variable currently has a column in the data:</p>
<div class="sourceCode" id="cb967"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb967-1"><a href="restructuring-data-frames.html#cb967-1" aria-hidden="true" tabindex="-1"></a>births_sex <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb967-2"><a href="restructuring-data-frames.html#cb967-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">state  =</span> <span class="fu">c</span>(<span class="st">&quot;CA&quot;</span>, <span class="st">&quot;FL&quot;</span>, <span class="st">&quot;TX&quot;</span>),</span>
<span id="cb967-3"><a href="restructuring-data-frames.html#cb967-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">f_2018 =</span> <span class="fu">c</span>(<span class="dv">222911</span>, <span class="dv">108556</span>, <span class="dv">185526</span>),</span>
<span id="cb967-4"><a href="restructuring-data-frames.html#cb967-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">m_2018 =</span> <span class="fu">c</span>(<span class="dv">232009</span>, <span class="dv">112986</span>, <span class="dv">193098</span>)</span>
<span id="cb967-5"><a href="restructuring-data-frames.html#cb967-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb967-6"><a href="restructuring-data-frames.html#cb967-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   state f_2018 m_2018
##   &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 CA    222911 232009
## 2 FL    108556 112986
## 3 TX    185526 193098</code></pre>
<p>In this case, we can tidy the data by giving <code>sex</code> and <code>year</code> a column, and giving the other data values (i.e., count of live births) a more informative column name. We can do so with the <code>pivot_longer()</code> function:</p>
<div class="sourceCode" id="cb969"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb969-1"><a href="restructuring-data-frames.html#cb969-1" aria-hidden="true" tabindex="-1"></a>births_sex <span class="sc">%&gt;%</span> </span>
<span id="cb969-2"><a href="restructuring-data-frames.html#cb969-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb969-3"><a href="restructuring-data-frames.html#cb969-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols      =</span> <span class="sc">-</span>state,</span>
<span id="cb969-4"><a href="restructuring-data-frames.html#cb969-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to  =</span> <span class="fu">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;year&quot;</span>),</span>
<span id="cb969-5"><a href="restructuring-data-frames.html#cb969-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>,</span>
<span id="cb969-6"><a href="restructuring-data-frames.html#cb969-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;births&quot;</span></span>
<span id="cb969-7"><a href="restructuring-data-frames.html#cb969-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
##   state sex   year  births
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;
## 1 CA    f     2018  222911
## 2 CA    m     2018  232009
## 3 FL    f     2018  108556
## 4 FL    m     2018  112986
## 5 TX    f     2018  185526
## 6 TX    m     2018  193098</code></pre>
</div>
<div id="each-observation-must-have-its-own-row" class="section level3" number="31.5.2">
<h3><span class="header-section-number">31.5.2</span> Each observation must have its own row</h3>
<p>Our person-level <code>babies</code> data frame above also violated this guideline.</p>
<div class="sourceCode" id="cb971"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb971-1"><a href="restructuring-data-frames.html#cb971-1" aria-hidden="true" tabindex="-1"></a>babies</span></code></pre></div>
<pre><code>## # A tibble: 8 × 10
##      id sex   weight_3 weight_6 weight_9 weight_12 length_3 length_6 length_9 length_12
##   &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1  1001 F            9       13       16        17       17       18       19        21
## 2  1002 F           11       16       17        20       19       21       23        23
## 3  1003 M           17       20       23        24       23       27       30        33
## 4  1004 F           16       18       21        22       20       22       24        26
## 5  1005 M           11       15       16        18       18       20       22        23
## 6  1006 M           17       21       25        26       22       26       28        30
## 7  1007 M           16       17       19        21       21       23       24        25
## 8  1008 F           15       16       18        19       18       19       23        24</code></pre>
<p>Notice that each baby in this data has one <code>row</code>, but that each row actually contains four unique observations – at 3, 6, 9, and 12 months. As another example, let’s say that we’ve once again downloaded birth count data from a government website. This time, we are interested in investigating the absolute change in live births over the decade between 2010 and 2020. That data may look like this:</p>
<div class="sourceCode" id="cb973"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb973-1"><a href="restructuring-data-frames.html#cb973-1" aria-hidden="true" tabindex="-1"></a>births_decade <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb973-2"><a href="restructuring-data-frames.html#cb973-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">state  =</span> <span class="fu">c</span>(<span class="st">&quot;CA&quot;</span>, <span class="st">&quot;FL&quot;</span>, <span class="st">&quot;TX&quot;</span>),</span>
<span id="cb973-3"><a href="restructuring-data-frames.html#cb973-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">2010</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">409428</span>, <span class="dv">199388</span>, <span class="dv">340762</span>),</span>
<span id="cb973-4"><a href="restructuring-data-frames.html#cb973-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">2020</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">454920</span>, <span class="dv">221542</span>, <span class="dv">378624</span>)</span>
<span id="cb973-5"><a href="restructuring-data-frames.html#cb973-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb973-6"><a href="restructuring-data-frames.html#cb973-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   state `2010` `2020`
##   &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 CA    409428 454920
## 2 FL    199388 221542
## 3 TX    340762 378624</code></pre>
<p>In this example, each state has a single row, but multiple observations. We can once again tidy this data using the <code>pivot_longer()</code> function:</p>
<div class="sourceCode" id="cb975"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb975-1"><a href="restructuring-data-frames.html#cb975-1" aria-hidden="true" tabindex="-1"></a>births_decade <span class="sc">%&gt;%</span> </span>
<span id="cb975-2"><a href="restructuring-data-frames.html#cb975-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb975-3"><a href="restructuring-data-frames.html#cb975-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols      =</span> <span class="sc">-</span>state,</span>
<span id="cb975-4"><a href="restructuring-data-frames.html#cb975-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to  =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb975-5"><a href="restructuring-data-frames.html#cb975-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;births&quot;</span></span>
<span id="cb975-6"><a href="restructuring-data-frames.html#cb975-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   state year  births
##   &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;
## 1 CA    2010  409428
## 2 CA    2020  454920
## 3 FL    2010  199388
## 4 FL    2020  221542
## 5 TX    2010  340762
## 6 TX    2020  378624</code></pre>
</div>
<div id="each-value-must-have-its-own-cell" class="section level3" number="31.5.3">
<h3><span class="header-section-number">31.5.3</span> Each value must have its own cell</h3>
<p>In my personal experience, violations of this guideline are rarer than violations of the first two guidelines. However, let’s imagine a study where we are monitoring the sleeping habits of newborn babies. Specifically, we are interested in the range of lengths of time they sleep. That data could be recorded the following way:</p>
<div class="sourceCode" id="cb977"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb977-1"><a href="restructuring-data-frames.html#cb977-1" aria-hidden="true" tabindex="-1"></a>baby_sleep <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb977-2"><a href="restructuring-data-frames.html#cb977-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">id          =</span> <span class="fu">c</span>(<span class="dv">1001</span>, <span class="dv">1002</span>, <span class="dv">1003</span>),</span>
<span id="cb977-3"><a href="restructuring-data-frames.html#cb977-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">sleep_range =</span> <span class="fu">c</span>(<span class="st">&quot;.5-2&quot;</span>, <span class="st">&quot;.75-2.4&quot;</span>, <span class="st">&quot;1.1-3.8&quot;</span>)</span>
<span id="cb977-4"><a href="restructuring-data-frames.html#cb977-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb977-5"><a href="restructuring-data-frames.html#cb977-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##      id sleep_range
##   &lt;dbl&gt; &lt;chr&gt;      
## 1  1001 .5-2       
## 2  1002 .75-2.4    
## 3  1003 1.1-3.8</code></pre>
<p>In this case, we will use a new function to tidy our data. We will use <code>tidyr</code>’s <code>separate()</code> function to spread these values out across two columns:</p>
<div class="sourceCode" id="cb979"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb979-1"><a href="restructuring-data-frames.html#cb979-1" aria-hidden="true" tabindex="-1"></a>baby_sleep <span class="sc">%&gt;%</span> </span>
<span id="cb979-2"><a href="restructuring-data-frames.html#cb979-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(</span>
<span id="cb979-3"><a href="restructuring-data-frames.html#cb979-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">col     =</span> sleep_range,</span>
<span id="cb979-4"><a href="restructuring-data-frames.html#cb979-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">into    =</span> <span class="fu">c</span>(<span class="st">&quot;min_hours&quot;</span>, <span class="st">&quot;max_hours&quot;</span>),</span>
<span id="cb979-5"><a href="restructuring-data-frames.html#cb979-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep     =</span> <span class="st">&quot;-&quot;</span>,</span>
<span id="cb979-6"><a href="restructuring-data-frames.html#cb979-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">convert =</span> <span class="cn">TRUE</span></span>
<span id="cb979-7"><a href="restructuring-data-frames.html#cb979-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##      id min_hours max_hours
##   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1  1001      0.5        2  
## 2  1002      0.75       2.4
## 3  1003      1.1        3.8</code></pre>
<p>👆<strong>Here’s what we did above:</strong></p>
<ul>
<li><p>We used <code>tidyr</code>’s <code>separate()</code> function to tidy the <code>baby_sleep</code> data frame.</p></li>
<li><p>You can type <code>?separate</code> into your R console to view the help documentation for this function and follow along with the explanation below.</p></li>
<li><p>The first argument to the <code>separate()</code> function is the <code>data</code> argument. You should pass the name of the data frame you want to restructure to the <code>data</code> argument. Above, we passed the <code>baby_sleep</code> data frame to the <code>data</code> argument using a pipe operator.</p></li>
<li><p>The second argument to the <code>separate()</code> function is the <code>col</code> argument. You should pass the name of the column contain the data values that you want to split up to the <code>col</code> argument.</p></li>
<li><p>The third argument to the <code>separate()</code> function is the <code>into</code> argument. You should pass the <code>into</code> argument a character vector of column names you want to give the new columns that will be created when you break apart the values in the <code>col</code> column.</p></li>
<li><p>The fourth argument to the <code>separate()</code> function is the <code>sep</code> argument. You should pass the <code>sep</code> argument a character string that tells <code>separate()</code> what character separates the individual values in the <code>col</code> column.</p></li>
<li><p>Finally, we passed the value <code>TRUE</code> to the <code>convert</code> argument. In doing so, we asked <code>separate()</code> to coerce the values in <code>min_hours</code> and <code>max_hours</code> from character type to numeric type.</p></li>
</ul>
</div>
</div>
<div id="the-complete-function" class="section level2" number="31.6">
<h2><span class="header-section-number">31.6</span> The complete() function</h2>
<p>The final function we’re going to discuss in this chapter is <code>tidyr</code>’s <code>complete()</code> function. After we pivot data, we will sometimes notice “holes” in the data. This typically happens to me in the context of time data. When this happens, we can use the <code>complete()</code> function to fill-in the holes in our data.</p>
<p>This next example didn’t actually involve pivoting, but it did come from another actual project that I was involved with, and nicely demonstrates the importance of filling-in holes in the data. As a part of this project, researchers were interested in increasing the number of reports of elder mistreatment that were being made to Adult Protective Services (APS) by emergency medical technicians (EMTs) and paramedics. Each row in the raw data the researchers received from the emergency medical services provider represented a report to APS. Let’s say that the data from the week of October 28th, 2019 to November 3rd, 2019 looked something like this:</p>
<div class="sourceCode" id="cb981"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb981-1"><a href="restructuring-data-frames.html#cb981-1" aria-hidden="true" tabindex="-1"></a>reports <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb981-2"><a href="restructuring-data-frames.html#cb981-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">date      =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(</span>
<span id="cb981-3"><a href="restructuring-data-frames.html#cb981-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;2019-10-29&quot;</span>, <span class="st">&quot;2019-10-29&quot;</span>, <span class="st">&quot;2019-10-30&quot;</span>, <span class="st">&quot;2019-11-02&quot;</span>, <span class="st">&quot;2019-11-02&quot;</span></span>
<span id="cb981-4"><a href="restructuring-data-frames.html#cb981-4" aria-hidden="true" tabindex="-1"></a>  )),</span>
<span id="cb981-5"><a href="restructuring-data-frames.html#cb981-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">emp_id    =</span> <span class="fu">c</span>(<span class="dv">5123</span>, <span class="dv">2224</span>, <span class="dv">5153</span>, <span class="dv">9876</span>, <span class="dv">4030</span>),</span>
<span id="cb981-6"><a href="restructuring-data-frames.html#cb981-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">report_id =</span> <span class="fu">c</span>(<span class="st">&quot;a8934&quot;</span>, <span class="st">&quot;af2as&quot;</span>, <span class="st">&quot;jzia3&quot;</span>, <span class="st">&quot;3293n&quot;</span>, <span class="st">&quot;dsf98&quot;</span>)</span>
<span id="cb981-7"><a href="restructuring-data-frames.html#cb981-7" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb981-8"><a href="restructuring-data-frames.html#cb981-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code></pre></div>
<pre><code>## # A tibble: 5 × 3
##   date       emp_id report_id
##   &lt;date&gt;      &lt;dbl&gt; &lt;chr&gt;    
## 1 2019-10-29   5123 a8934    
## 2 2019-10-29   2224 af2as    
## 3 2019-10-30   5153 jzia3    
## 4 2019-11-02   9876 3293n    
## 5 2019-11-02   4030 dsf98</code></pre>
<p>Where:</p>
<ul>
<li><p><code>date</code> is the date the report was made to APS.</p></li>
<li><p><code>emp_id</code> is a unique identifier for each EMT or paramedic.</p></li>
<li><p><code>report_id</code> is the unique identifier APS assigns to the incoming report.</p></li>
</ul>
<p>Let’s say that the researchers were interested in calculating the average number of reports per day. We would first need to count the number of reports made each day:</p>
<div class="sourceCode" id="cb983"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb983-1"><a href="restructuring-data-frames.html#cb983-1" aria-hidden="true" tabindex="-1"></a>reports <span class="sc">%&gt;%</span> </span>
<span id="cb983-2"><a href="restructuring-data-frames.html#cb983-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(date)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   date           n
##   &lt;date&gt;     &lt;int&gt;
## 1 2019-10-29     2
## 2 2019-10-30     1
## 3 2019-11-02     2</code></pre>
<p>Next, we might naively go ahead and calculate the mean of n like this:</p>
<div class="sourceCode" id="cb985"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb985-1"><a href="restructuring-data-frames.html#cb985-1" aria-hidden="true" tabindex="-1"></a>reports <span class="sc">%&gt;%</span> </span>
<span id="cb985-2"><a href="restructuring-data-frames.html#cb985-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(date) <span class="sc">%&gt;%</span> </span>
<span id="cb985-3"><a href="restructuring-data-frames.html#cb985-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_reports_per_day =</span> <span class="fu">mean</span>(n))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   mean_reports_per_day
##                  &lt;dbl&gt;
## 1                 1.67</code></pre>
<p>And conclude that the mean number of reports made per day was 1.67. However, there is a problem with this strategy. Our study period wasn’t three days long. It was seven days long (i.e., October 28th, 2019 to November 3rd, 2019). Because there weren’t any reports made on 2019-10-28, 2019-10-31, 2019-11-01, or 2019-11-03 they don’t exist in our count data. But, their absence doesn’t represent a missing or unknown value. Their absence represents zero reports being made on that day. We need to explicitly encode that information in our count data if we want to accurately calculate the mean number of reports per day. In this tiny little simulated data frame, it’s trivial to do this calculation manually. However, the real data set was collected over a three-year period. That’s over 1,000 days that would have to be manually accounted for.</p>
<p>Luckily, we can use <code>tidyr</code>’s <code>complete()</code> function, along with the <code>seq.Date()</code> function we learned in the chapter on working with date variables, to fill-in the holes in our count data in an automated way:</p>
<div class="sourceCode" id="cb987"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb987-1"><a href="restructuring-data-frames.html#cb987-1" aria-hidden="true" tabindex="-1"></a>reports <span class="sc">%&gt;%</span> </span>
<span id="cb987-2"><a href="restructuring-data-frames.html#cb987-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(date) <span class="sc">%&gt;%</span> </span>
<span id="cb987-3"><a href="restructuring-data-frames.html#cb987-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(</span>
<span id="cb987-4"><a href="restructuring-data-frames.html#cb987-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">seq.Date</span>(</span>
<span id="cb987-5"><a href="restructuring-data-frames.html#cb987-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">from =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2019-10-28&quot;</span>), </span>
<span id="cb987-6"><a href="restructuring-data-frames.html#cb987-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">to =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2019-11-03&quot;</span>), </span>
<span id="cb987-7"><a href="restructuring-data-frames.html#cb987-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">by =</span> <span class="st">&quot;days&quot;</span></span>
<span id="cb987-8"><a href="restructuring-data-frames.html#cb987-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb987-9"><a href="restructuring-data-frames.html#cb987-9" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 7 × 2
##   date           n
##   &lt;date&gt;     &lt;int&gt;
## 1 2019-10-28    NA
## 2 2019-10-29     2
## 3 2019-10-30     1
## 4 2019-10-31    NA
## 5 2019-11-01    NA
## 6 2019-11-02     2
## 7 2019-11-03    NA</code></pre>
<p>👆<strong>Here’s what we did above:</strong></p>
<ul>
<li><p>We used <code>tidyr</code>’s <code>complete()</code> function to fill-in the holes in the dates between 2019-10-28 and 2019-11-03.</p></li>
<li><p>You can type <code>?complete</code> into your R console to view the help documentation for this function and follow along with the explanation below.</p></li>
<li><p>The first argument to the <code>complete()</code> function is the <code>data</code> argument. You should pass the name of the data frame that contains the column you want to fill-in to the <code>data</code> argument. Above, we passed the <code>reports</code> data frame to the <code>data</code> argument using a pipe operator.</p></li>
<li><p>The second argument to the <code>complete()</code> function is the <code>...</code> argument. This is where you tell the <code>complete()</code> function which column you want to fill-in, or expand, and give it instructions for doing so. Above, we asked <code>complete()</code> to make sure that each day between 2019-10-28 and 2019-11-03 was included in our <code>date</code> column. We did so by asking <code>complete()</code> to set the date column equal to the returned values from the <code>seq.Date()</code> function.</p></li>
</ul>
<p>Notice that all the days during our period of interest are now included in our count data. However, by default, the value for each new row of the <code>n</code> column is set to <code>NA</code>. But, as we already discussed, <code>n</code> isn’t missing for those days, it’s zero. We can change those values from <code>NA</code> to zero by adjusting the value we pass to the <code>fill</code> argument. We’ll do that next:</p>
<div class="sourceCode" id="cb989"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb989-1"><a href="restructuring-data-frames.html#cb989-1" aria-hidden="true" tabindex="-1"></a>reports <span class="sc">%&gt;%</span> </span>
<span id="cb989-2"><a href="restructuring-data-frames.html#cb989-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(date) <span class="sc">%&gt;%</span> </span>
<span id="cb989-3"><a href="restructuring-data-frames.html#cb989-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(</span>
<span id="cb989-4"><a href="restructuring-data-frames.html#cb989-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">seq.Date</span>(</span>
<span id="cb989-5"><a href="restructuring-data-frames.html#cb989-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">from =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2019-10-28&quot;</span>), </span>
<span id="cb989-6"><a href="restructuring-data-frames.html#cb989-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">to =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2019-11-03&quot;</span>), </span>
<span id="cb989-7"><a href="restructuring-data-frames.html#cb989-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">by =</span> <span class="st">&quot;days&quot;</span></span>
<span id="cb989-8"><a href="restructuring-data-frames.html#cb989-8" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb989-9"><a href="restructuring-data-frames.html#cb989-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">n =</span> <span class="dv">0</span>)</span>
<span id="cb989-10"><a href="restructuring-data-frames.html#cb989-10" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 7 × 2
##   date           n
##   &lt;date&gt;     &lt;dbl&gt;
## 1 2019-10-28     0
## 2 2019-10-29     2
## 3 2019-10-30     1
## 4 2019-10-31     0
## 5 2019-11-01     0
## 6 2019-11-02     2
## 7 2019-11-03     0</code></pre>
<p>Now, we can finally calculate the correct value for mean number of reports made per day during the week of October 28th, 2019 to November 3rd, 2019:</p>
<div class="sourceCode" id="cb991"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb991-1"><a href="restructuring-data-frames.html#cb991-1" aria-hidden="true" tabindex="-1"></a>reports <span class="sc">%&gt;%</span> </span>
<span id="cb991-2"><a href="restructuring-data-frames.html#cb991-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(date) <span class="sc">%&gt;%</span> </span>
<span id="cb991-3"><a href="restructuring-data-frames.html#cb991-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(</span>
<span id="cb991-4"><a href="restructuring-data-frames.html#cb991-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">seq.Date</span>(</span>
<span id="cb991-5"><a href="restructuring-data-frames.html#cb991-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">from =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2019-10-28&quot;</span>), </span>
<span id="cb991-6"><a href="restructuring-data-frames.html#cb991-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">to =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2019-11-03&quot;</span>), </span>
<span id="cb991-7"><a href="restructuring-data-frames.html#cb991-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">by =</span> <span class="st">&quot;days&quot;</span></span>
<span id="cb991-8"><a href="restructuring-data-frames.html#cb991-8" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb991-9"><a href="restructuring-data-frames.html#cb991-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">n =</span> <span class="dv">0</span>)</span>
<span id="cb991-10"><a href="restructuring-data-frames.html#cb991-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb991-11"><a href="restructuring-data-frames.html#cb991-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_reports_per_day =</span> <span class="fu">mean</span>(n))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   mean_reports_per_day
##                  &lt;dbl&gt;
## 1                0.714</code></pre>
<p>That concludes the chapter on restructuring data. For now, it also concludes the part of this book devoted to the basics of data management. At this point, you should have the tools you need to tackle the majority of the common data management tasks that you will come across. Further, there’s a good chance that the packages we’ve used in this part of the book will contain a solution for the remaining data management challenges that we haven’t explicitly covered. In the next part of the book, we will dive into repeated operations.</p>

</div>
</div>




</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body">
<div id="ref-Wickham2014-gy" class="csl-entry">
<div class="csl-left-margin">5. </div><div class="csl-right-inline">Wickham H. Tidy data. <em>Journal of Statistical Software, Articles</em>. 2014;59(10):1-23.</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="working-with-multiple-data-frames.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="introduction-to-repeated-operations.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/brad-cannell/r4epi/edit/master/chapters/05_part_data_management/10_restructuring_data_frames.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
