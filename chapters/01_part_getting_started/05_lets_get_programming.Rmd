# Letâ€™s get programming

In this chapter, we are going to tie together many of the concepts we've learned so far, and you are going to create your first basic R program. Specifically, you are going to write a program that simulates some data and analyzes it. 

## Simulating data

Data simulation can be really complicated, but it doesn't have to be. It is simply the process of _creating_ data as opposed to _finding data in the wild_. This can be really useful in several different ways.

1. Simulating data is really useful for getting help with a problem you are trying to solve. Often, it isn't feasible for you to send other people the actual data set you are working on when you encounter a problem you need help with. Sometimes, it may not even be legally allowed (i.e., for privacy reasons).Instead of send them your entire data set, you can simulate a little data set that recreates the challenge you are trying to address without all the other complexity of the full data set. As a bonus, I have often found that I end up figuring out the solution to the problem I'm trying to solve as I recreate the problem in a simulated data set that I intended to share with others.

2. Simulated data can also be useful for learning about and testing statistical assumptions. In epidemiology, we use statistics to draw conclusions about populations of people we are interested in based on samples of people drawn from the population. Because we don't actually have data from _all_ the people in the population, we have to make some assumptions about the population based on what we find in our sample. When we simulate data, we know the truth about our population because we _created_ our population to have that truth. We can then use this simulated populations to play "what if" games with our analysis. _What if we only sampled half as many people?_ _What if their heights aren't actually normally distributed?_ _What if we used a probit model instead of a logit model?_ Going through this process and answering these questions can help us understand how much, and under what circumstances, we can trust the answers we found in the real world. 

So, let's go ahead write a complete r program to simulate and analyze some data. As I said, it doesn't have to be complicated. In fact, below you can see some data I've simulated about a hypothetical class.

```{r}
class <- data.frame(
  names   = c("John", "Sally", "Brad", "anne"),
  heights = c(68, 63, 71, 72)
)
```

```{r}
class
```

```{r}
mean(class$heights)
```

As you can see, this data frame contains the student's names and heights. We also use the `mean()` function to calculate the average height of the class. By the ed of this chapter, you will understand all the elements of this R code and how to simulate your own data.

## Vectors

Vectors are the most fundamental data structure in R. Here, data structure means "container for our data." There are other data structures as well; however, they are all built from vectors. That's why I say vectors are the most fundamental data structure. Some of these other structures are matricies, lists, and data frames. In this book, we won't use matricies or lists much at all, so, you can forget about them for now. Instead, we will almost exclusively use data frames hold and manipulate our data. However, because data frames are built from vectors, it can be useful to start by learning a little bit about them. Let's do that now.

```{r}
names <- c("John", "Sally", "Brad", "anne")
names
```

**Here's what we did above:**

* We _created_ a vector of names with the `c()` (short for combine) function.    
  - The vector contains four values: "John", "Sally", "Brad", and "anne".   
  - All of the values are character strings (i.e., words). We know this because all of the values are wrapped with quotation marks.    
  - Here we used double quotes, but we could have also used single quotes. We cannot, however, mix double and single quotes for each character string. `c("John', ...)` won't work.   

* We _assigned_ that vector of character strings to the word `names` using the `<-` function.   
  - R now recognizes `names` as an **object** that we can do things with.   
  - R programmers may refer to the names object as "the names object", "the names vector", or "the names variable". For our purposes, these all mean the same thing.
  
* We _printed_ the contents of the `names` object to the screen by typing the "names".    
  - R **returns** (shows us) the four character values ("John"  "Sally" "Brad"  "anne") on the computer screen.   

Try copying and pasting the code above into the RStudio console on your computer. You should notice the names vector appear in your **global envirnoment**. You may also notice that the global environment pane gives you some additional infomation about this vector to the right of its name. Specifically, you should see `chr [1:4] "John"  "Sally" "Brad"  "anne"`. This is R telling us that `names` is a character vector (`chr`), with four values (`[1:4]`), and the first four values are `"John"  "Sally" "Brad"  "anne"`.

### Vector types

There are several different vector **types**, but each vector can have only one type. The type of the vector above was character. We can validate that with the `typeof()` function like so:

```{r}
typeof(names)
```

The other vector types that we will use in this book are double, integer, and logical. Double vectors hold [real numbers](https://en.wikipedia.org/wiki/Real_number). Integer vectors hold [integers](https://en.wikipedia.org/wiki/Integer). Collectively, double vectors and integer vectors are known as numeric vectors. Logical vectors can only hold the values TRUE and FALSE. Here are some examples of each:

```{r}
# A numeric vector
my_numbers <- c(12.5, 13.98765, pi)
my_numbers
```

```{r}
typeof(my_numbers)
```

```{r}
# An integer vector - first attempt
my_ints_1 <- c(1, 2, 3)
my_ints_1
```

```{r}
typeof(my_ints_1)
```

```{r}
# An integer vector
# Must put "L" behind the number to make it an integer. No idea why they chose "L".
my_ints_2 <- c(1L, 2L, 3L)
my_ints_2
```

```{r}
typeof(my_ints_2)
```

```{r}
# An integer vector
# Type TRUE and FALSE in all caps
my_logical <- c(TRUE, FALSE, TRUE)
my_logical
```

```{r}
typeof(my_logical)
```

## Data frames

Vectors are useful for storing a single type of information. However, in epidemiology, we typically want to know many different types of information about whatever we happen to be studying. For example, we didn't just want the names of the people in our class, we also wanted the heights. Of course, we can store the heights in a vector like so:

```{r}
heights <- c(68, 63, 71, 72)
heights
```

But this doesn't tell us which height goes with which person. When we want to create relationships between our vectors, we can use them to build a data frame. For example:

```{r}
# Create a vector of names
names <- c("John", "Sally", "Brad", "anne")
# Create a vector of heights
heights <- c(68, 63, 71, 72)
# Combine them into a data frame
class <- data.frame(names, heights)
# Print the data frame to the screen
class
```

**Here's what we did above:**

* We _created_ a data frame with the `data.frame()` function.    
  - The first argument we passed to the `data.frame()` function was a vector of names that we previously created.
  - The second argument we passed to the `data.frame()` function was a vector of heights that we previously created.

* We _assigned_ that data frame to the word `class` using the `<-` function.   
  - R now recognizes `class` as an **object** that we can do things with.   
  - R programmers may refer to the names object as "the clas object" or "the class data frame". For our purposes, these all mean the same thing. We could also call it a data set, but that term isn't used much in R circles.
  
* We _printed_ the contents of the `class` object to the screen by typing the "class".    
  - R **returns** (shows us) the data frame on the computer screen.   

Try copying and pasting the code above into the RStudio console on your computer. You should notice the `class` data frame appear in your **global envirnoment**. You may also notice that the global environment pane gives you some additional infomation about this data frame to the right of its name. Specifically, you should see `4 obs. of 2 variables`. This is R telling us that `class` has four rows or observations (`4 obs.`) and two columsn or variables (`2 variables`). If you click the little blue arrow to the left of the data frame's name, you will see information about the individual vectors that make up the data frame. 

As a shortcut, instead of creating individual vectors and then combining them into a data frame as we've done above, most R programmers will vectors directly inside of the data frame function like this:

```{r}
class <- data.frame(
  names   = c("John", "Sally", "Brad", "anne"),
  heights = c(68, 63, 71, 72)
)
class
```

As you can see, both methods produce the exact same result. The second method, however, requires a little less typing and results in fewer objects cluttering up your globabl environment. What I mean by that is that the `names` and `heights` vectors won't exist independently in your global environment. Rather, they will only exist as columns of the `class` data frame.

You may have also noticed that when we created the `names` and `heights` vectors (columns) directly inside of the `data.frame()` function we used the equal sign (`=`) to assign values instead of the assignment arrow (`<-`). This is just one of those quirky R exceptions we talked about in the chapter on speaking R's language. In fact, `=` and `<-` can be used interchangably in R. It is only by convention that we usually use `<-` for assigning values, but use `=` for assigning values to columns in data frames. I don't know why this is the convention. If it were up to me, we wouldn't do this. We would just pick `=` or `<-` and use it in all cases where we want to assign values. But, it isn't up to me and I gave up on trying to fight it a long time ago. Your R programming life will be easier if you just learn to assign values this way -- even if it's dumb.

## Our first analysis

congratulations on your new R programming skills. ðŸŽ‰ You can now create vectors and data frames. This is no small thing. Basically, everything else we do in this book will start with vectors and data frames.

Having said that, creating data frames, in and of itself, is not super exciting. So, let's round out this chapter with a basic desccriptive analysis of the data we simulated. Specifically, let's find the mean height of the class.

You will find that in R there are almost always many different ways to accomplish a given task. Sometimes, choosing one over another is simply a matter of preference. Other times, one method is clearly more efficient and/or accurate than another. This is a point that will come up over and over in this book. Let's use our desire to find the mean height of the class as an example.

For starters, we can add up all the heights and divide by the total number of heights to find the mean.

```{r}
(68 + 63 + 71 + 72) / 4
```

This works, but why might it not be the best approach? Well, for starters, manually typing in the heights is error prone. We can easily accidently press the wrong key. Luckily, we already have the heights stored as a column in the `class` data frame. We can _access_ or _refer to_ a single column in a data frame using the **dollar sign syntax**.

```{r}
class$heights
```

**Here's what we did above:**

* We used the dollar sign syntax to _access_ the `heights` column in the `class` data frame.   
  - Dollar sign syntax is just the data frame name, followed by the dollar sign, followed by the column name.   
  
Further, we can use **bracket notation** to access each value in a vector. I think it's easier to demonstrate bracket notation than it is to describe it. For example, we could access the third value in the names vector like this:

```{r}
# Create the heights vector
heights <- c(68, 63, 71, 72)

# Access the third element in the heights vector with bracket notation
heights[3]
```

Remember, that data frame columns are also vectors. So, we can combine the dollar sign syntax and bracket notation, to access each individual value of the `height` column in the `class` data frame. This will help us get around the problem of typing each individual height value. For example:

```{r}
# First way to calculate the mean
# (68 + 63 + 71 + 72) / 4

# Second way. Use dollar sign syntax and bracket notation so that we don't have to type individual heights
(class$heights[1] + class$heights[2] + class$heights[3] + class$heights[4]) / 4
```

The second method is better in the sense that we no longer have to worry about mistyping the heights. However, who wants to type `class$heights[...]` over and over? What if we had a hundred numbers? What if we had a thousand numbers? This wouldn't work. Luckily, there is a function that adds all the numbers contained in a numeric vector -- the `sum()` function. Let's take a look:

```{r}
# Create the heights vector
heights <- c(68, 63, 71, 72)

# Add together all the individual heights
sum(heights)
```

Remember, that data frame columns are also vectors. So, we can combine the dollar sign syntax and `sum()` function, to add up all the individual heights in the `heights` column of the `class` data frame. It looks like this:

```{r}
# First way to calculate the mean
# (68 + 63 + 71 + 72) / 4

# Second way. Use dollar sign syntax and bracket notation so that we don't have to type individual heights
# (class$heights[1] + class$heights[2] + class$heights[3] + class$heights[4]) / 4

# Third way. Use dollar sign syntax and sum function so that we don't have to type as much
sum(class$heights) / 4
```

**Here's what we did above:**

* We passed the numeric vector `heights` from the `class` data frame to the `sum()` function using dollar sign syntax.  
* The `sum()` function returned the total value of all the heights added together.    
* We divided the total value of the heights by four -- the number of individual heights.   

I think most of us would agree that the third method is preferable to the first two methods for most situations. However, the third method still requires us to know how many individual heights are in the heights column (i.e., 4). Luckily, there is a function that tells us how many individual values are contained in a vector -- the `length()` function. Let's take a look:

```{r}
# Create the heights vector
heights <- c(68, 63, 71, 72)

# Return the number of individual values in heights
length(heights)
```

Remember, that data frame columns are also vectors. So, we can combine the dollar sign syntax and `length()` function, to automatically calculate the number of values in the `heights` column of the `class` data frame. It looks like this:

```{r}
# First way to calculate the mean
# (68 + 63 + 71 + 72) / 4

# Second way. Use dollar sign syntax and bracket notation so that we don't have to type individual heights
# (class$heights[1] + class$heights[2] + class$heights[3] + class$heights[4]) / 4

# Third way. Use dollar sign syntax and sum function so that we don't have to type as much
# sum(class$heights) / 4

# Fourth way. Use dollar sign syntax with the sum function and the length function
sum(class$heights) / length(class$heights)
```

**Here's what we did above:**

* We passed the numeric vector `heights` from the `class` data frame to the `sum()` function using dollar sign syntax.  
* The `sum()` function returned the total value of all the heights added together.    
* We passed the numeric vector `heights` from the `class` data frame to the `length()` function using dollar sign syntax.  
* The `length()` function returned the total number of values in the `heights` column.   
* We divided the total value of the heights by the total number of values in the `heights` column.     

The fourth method above is definitely the best method yet. However, this need to find the mean value of a numeric vector is so common that someone had the sense to create a function that takes care of all the above steps for us -- the `mean()` function. And as you probably saw coming, we can use the mean function like so:

```{r}
# First way to calculate the mean
# (68 + 63 + 71 + 72) / 4

# Second way. Use dollar sign syntax and bracket notation so that we don't have to type individual heights
# (class$heights[1] + class$heights[2] + class$heights[3] + class$heights[4]) / 4

# Third way. Use dollar sign syntax and sum function so that we don't have to type as much
# sum(class$heights) / 4

# Fourth way. Use dollar sign syntax with the sum function and the length function
# sum(class$heights) / length(class$heights)

# Fifth way. Use dollar sign syntax with the mean function
mean(class$heights)
```

Congratulations again! You completed your first analysis using R. Before we move on, I want to briefly discuss a couple common errors that will frustrate many of you early in your R journey. You may have noticed that I went out of my way to differentiate between the `heights` vector and the `heights` column in the `class` data frame. As annoying as that may have been, I did it for a reason. The `heights` vector and the `heights` column in the `class` data frame are two separte things to the R interpreter and you have to be very specific about which one you are refering to. To make this more concrete, let's add a `weight` column to our `class` data frame.

```{r}
class$weight <- c(160, 170, 180, 190)
```

**Here's what we did above:**

* We created a new column in our data frame -- `weight` -- using dollar sign syntax.   

Now let's find the mean weight of the students in our class.

```{r error=TRUE}
mean(weight)
```

Uh, oh! What happened? What happend? Why is R saying that `weight` doesn't exist? We clearly created it above, right? Wrong. We didn't create an object called weight in the code chunk above. We created a _column_ called `weight` in the _object_ called `class` in the code chunk above. Those are different things to R. If we want to get the mean of `weight` we have to tell R that `weight` is a column in `class` like so:

```{r}
mean(class$weight)
```

As related issue can arise when you have an object and a column with the same name but different values. For example:

```{r}
# An object called scores
scores <- c(5, 9, 3)

# A colummn in class called scores
class$scores <- c(95, 97, 93, 100)
```

If you ask R for the mean of `scores`, R will give you an answer.

```{r}
mean(scores)
```

However, if you wanted the mean of the `scores` column in the `class` data frame, this won't be the _correct_ answer. Hopefully, you already know how to get the correct answer, which is:

```{r}
mean(class$scores)
```

Again, the `scores` object and the `scores` column of the `class` object are different things to R.

## Summary

Wow! We covered a lot in this first part of the book on getting started with R and RStudio. Don't feel bad if your head is swimming. It's a lot to take-in. However, you should feel proud of the fact that you can already do some legitimately useful things with R. Namely, simulate and analyze data. In the next part of this book, we are going to discuss some tools and best practices for more easily and efficiently writing R code before moving on to tackling more advanced programming and data analysis challenges.
